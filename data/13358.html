<!DOCTYPE html>
<!--Whatever your mind can conceive and can believe, it can achieve. ~Napoleon Hill

Whatever we think about and thank about we bring about. ~John Demartini

Whether you think you can or canâ€™t either way you are right. ~Henry Ford-->
<html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type"/>
  <meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible"/>
  <script type="text/javascript">
   window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"0f3d20e9cb","applicationID":"1979363","transactionName":"IApZEUReXVUGRElGQAwPUgZCQh5KC1kR","queueTime":0,"applicationTime":172,"agent":""}
  </script>
  <script type="text/javascript">
   (window.NREUM||(NREUM={})).loader_config={xpid:"Vg4OUlNUGwIJU1hRAQI="};window.NREUM||(NREUM={}),__nr_require=function(t,e,n){function r(n){if(!e[n]){var o=e[n]={exports:{}};t[n][0].call(o.exports,function(e){var o=t[n][1][e];return r(o||e)},o,o.exports)}return e[n].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,n){function r(t){try{s.console&&console.log(t)}catch(e){}}var o,i=t("ee"),a=t(14),s={};try{o=localStorage.getItem("__nr_flags").split(","),console&&"function"==typeof console.log&&(s.console=!0,-1!==o.indexOf("dev")&&(s.dev=!0),-1!==o.indexOf("nr_dev")&&(s.nrDev=!0))}catch(c){}s.nrDev&&i.on("internal-error",function(t){r(t.stack)}),s.dev&&i.on("fn-err",function(t,e,n){r(n.stack)}),s.dev&&(r("NR AGENT IN DEVELOPMENT MODE"),r("flags: "+a(s,function(t,e){return t}).join(", ")))},{}],2:[function(t,e,n){function r(t,e,n,r,o){try{d?d-=1:i("err",[o||new UncaughtException(t,e,n)])}catch(s){try{i("ierr",[s,(new Date).getTime(),!0])}catch(c){}}return"function"==typeof f?f.apply(this,a(arguments)):!1}function UncaughtException(t,e,n){this.message=t||"Uncaught error with no additional information",this.sourceURL=e,this.line=n}function o(t){i("err",[t,(new Date).getTime()])}var i=t("handle"),a=t(15),s=t("ee"),c=t("loader"),f=window.onerror,u=!1,d=0;c.features.err=!0,t(1),window.onerror=r;try{throw new Error}catch(l){"stack"in l&&(t(8),t(7),"addEventListener"in window&&t(5),c.xhrWrappable&&t(9),u=!0)}s.on("fn-start",function(t,e,n){u&&(d+=1)}),s.on("fn-err",function(t,e,n){u&&(this.thrown=!0,o(n))}),s.on("fn-end",function(){u&&!this.thrown&&d>0&&(d-=1)}),s.on("internal-error",function(t){i("ierr",[t,(new Date).getTime(),!0])})},{}],3:[function(t,e,n){t("loader").features.ins=!0},{}],4:[function(t,e,n){function r(t){}if(window.performance&&window.performance.timing&&window.performance.getEntriesByType){var o=t("ee"),i=t("handle"),a=t(8),s=t(7);t("loader").features.stn=!0,t(6);var c=NREUM.o.EV;o.on("fn-start",function(t,e){var n=t[0];n instanceof c&&(this.bstStart=Date.now())}),o.on("fn-end",function(t,e){var n=t[0];n instanceof c&&i("bst",[n,e,this.bstStart,Date.now()])}),a.on("fn-start",function(t,e,n){this.bstStart=Date.now(),this.bstType=n}),a.on("fn-end",function(t,e){i("bstTimer",[e,this.bstStart,Date.now(),this.bstType])}),s.on("fn-start",function(){this.bstStart=Date.now()}),s.on("fn-end",function(t,e){i("bstTimer",[e,this.bstStart,Date.now(),"requestAnimationFrame"])}),o.on("pushState-start",function(t){this.time=Date.now(),this.startPath=location.pathname+location.hash}),o.on("pushState-end",function(t){i("bstHist",[location.pathname+location.hash,this.startPath,this.time])}),"addEventListener"in window.performance&&(window.performance.clearResourceTimings?window.performance.addEventListener("resourcetimingbufferfull",function(t){i("bstResource",[window.performance.getEntriesByType("resource")]),window.performance.clearResourceTimings()},!1):window.performance.addEventListener("webkitresourcetimingbufferfull",function(t){i("bstResource",[window.performance.getEntriesByType("resource")]),window.performance.webkitClearResourceTimings()},!1)),document.addEventListener("scroll",r,!1),document.addEventListener("keypress",r,!1),document.addEventListener("click",r,!1)}},{}],5:[function(t,e,n){function r(t){for(var e=t;e&&!e.hasOwnProperty(u);)e=Object.getPrototypeOf(e);e&&o(e)}function o(t){s.inPlace(t,[u,d],"-",i)}function i(t,e){return t[1]}var a=t("ee").get("events"),s=t(16)(a),c=t("gos"),f=XMLHttpRequest,u="addEventListener",d="removeEventListener";e.exports=a,"getPrototypeOf"in Object?(r(document),r(window),r(f.prototype)):f.prototype.hasOwnProperty(u)&&(o(window),o(f.prototype)),a.on(u+"-start",function(t,e){if(t[1]){var n=t[1];if("function"==typeof n){var r=c(n,"nr@wrapped",function(){return s(n,"fn-",null,n.name||"anonymous")});this.wrapped=t[1]=r}else"function"==typeof n.handleEvent&&s.inPlace(n,["handleEvent"],"fn-")}}),a.on(d+"-start",function(t){var e=this.wrapped;e&&(t[1]=e)})},{}],6:[function(t,e,n){var r=t("ee").get("history"),o=t(16)(r);e.exports=r,o.inPlace(window.history,["pushState","replaceState"],"-")},{}],7:[function(t,e,n){var r=t("ee").get("raf"),o=t(16)(r);e.exports=r,o.inPlace(window,["requestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame"],"raf-"),r.on("raf-start",function(t){t[0]=o(t[0],"fn-")})},{}],8:[function(t,e,n){function r(t,e,n){t[0]=a(t[0],"fn-",null,n)}function o(t,e,n){this.method=n,this.timerDuration="number"==typeof t[1]?t[1]:0,t[0]=a(t[0],"fn-",this,n)}var i=t("ee").get("timer"),a=t(16)(i);e.exports=i,a.inPlace(window,["setTimeout","setImmediate"],"setTimer-"),a.inPlace(window,["setInterval"],"setInterval-"),a.inPlace(window,["clearTimeout","clearImmediate"],"clearTimeout-"),i.on("setInterval-start",r),i.on("setTimer-start",o)},{}],9:[function(t,e,n){function r(t,e){d.inPlace(e,["onreadystatechange"],"fn-",s)}function o(){var t=this,e=u.context(t);t.readyState>3&&!e.resolved&&(e.resolved=!0,u.emit("xhr-resolved",[],t)),d.inPlace(t,v,"fn-",s)}function i(t){w.push(t),h&&(g=-g,b.data=g)}function a(){for(var t=0;t<w.length;t++)r([],w[t]);w.length&&(w=[])}function s(t,e){return e}function c(t,e){for(var n in t)e[n]=t[n];return e}t(5);var f=t("ee"),u=f.get("xhr"),d=t(16)(u),l=NREUM.o,p=l.XHR,h=l.MO,m="readystatechange",v=["onload","onerror","onabort","onloadstart","onloadend","onprogress","ontimeout"],w=[];e.exports=u;var y=window.XMLHttpRequest=function(t){var e=new p(t);try{u.emit("new-xhr",[e],e),e.addEventListener(m,o,!1)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}return e};if(c(p,y),y.prototype=p.prototype,d.inPlace(y.prototype,["open","send"],"-xhr-",s),u.on("send-xhr-start",function(t,e){r(t,e),i(e)}),u.on("open-xhr-start",r),h){var g=1,b=document.createTextNode(g);new h(a).observe(b,{characterData:!0})}else f.on("fn-end",function(t){t[0]&&t[0].type===m||a()})},{}],10:[function(t,e,n){function r(t){var e=this.params,n=this.metrics;if(!this.ended){this.ended=!0;for(var r=0;l>r;r++)t.removeEventListener(d[r],this.listener,!1);if(!e.aborted){if(n.duration=(new Date).getTime()-this.startTime,4===t.readyState){e.status=t.status;var i=o(t,this.lastSize);if(i&&(n.rxSize=i),this.sameOrigin){var a=t.getResponseHeader("X-NewRelic-App-Data");a&&(e.cat=a.split(", ").pop())}}else e.status=0;n.cbTime=this.cbTime,u.emit("xhr-done",[t],t),c("xhr",[e,n,this.startTime])}}}function o(t,e){var n=t.responseType;if("json"===n&&null!==e)return e;var r="arraybuffer"===n||"blob"===n||"json"===n?t.response:t.responseText;return i(r)}function i(t){if("string"==typeof t&&t.length)return t.length;if("object"==typeof t){if("undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer&&t.byteLength)return t.byteLength;if("undefined"!=typeof Blob&&t instanceof Blob&&t.size)return t.size;if(!("undefined"!=typeof FormData&&t instanceof FormData))try{return JSON.stringify(t).length}catch(e){return}}}function a(t,e){var n=f(e),r=t.params;r.host=n.hostname+":"+n.port,r.pathname=n.pathname,t.sameOrigin=n.sameOrigin}var s=t("loader");if(s.xhrWrappable){var c=t("handle"),f=t(11),u=t("ee"),d=["load","error","abort","timeout"],l=d.length,p=t("id"),h=t(13),m=window.XMLHttpRequest;s.features.xhr=!0,t(9),u.on("new-xhr",function(t){var e=this;e.totalCbs=0,e.called=0,e.cbTime=0,e.end=r,e.ended=!1,e.xhrGuids={},e.lastSize=null,h&&(h>34||10>h)||window.opera||t.addEventListener("progress",function(t){e.lastSize=t.loaded},!1)}),u.on("open-xhr-start",function(t){this.params={method:t[0]},a(this,t[1]),this.metrics={}}),u.on("open-xhr-end",function(t,e){"loader_config"in NREUM&&"xpid"in NREUM.loader_config&&this.sameOrigin&&e.setRequestHeader("X-NewRelic-ID",NREUM.loader_config.xpid)}),u.on("send-xhr-start",function(t,e){var n=this.metrics,r=t[0],o=this;if(n&&r){var a=i(r);a&&(n.txSize=a)}this.startTime=(new Date).getTime(),this.listener=function(t){try{"abort"===t.type&&(o.params.aborted=!0),("load"!==t.type||o.called===o.totalCbs&&(o.onloadCalled||"function"!=typeof e.onload))&&o.end(e)}catch(n){try{u.emit("internal-error",[n])}catch(r){}}};for(var s=0;l>s;s++)e.addEventListener(d[s],this.listener,!1)}),u.on("xhr-cb-time",function(t,e,n){this.cbTime+=t,e?this.onloadCalled=!0:this.called+=1,this.called!==this.totalCbs||!this.onloadCalled&&"function"==typeof n.onload||this.end(n)}),u.on("xhr-load-added",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&!this.xhrGuids[n]&&(this.xhrGuids[n]=!0,this.totalCbs+=1)}),u.on("xhr-load-removed",function(t,e){var n=""+p(t)+!!e;this.xhrGuids&&this.xhrGuids[n]&&(delete this.xhrGuids[n],this.totalCbs-=1)}),u.on("addEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&u.emit("xhr-load-added",[t[1],t[2]],e)}),u.on("removeEventListener-end",function(t,e){e instanceof m&&"load"===t[0]&&u.emit("xhr-load-removed",[t[1],t[2]],e)}),u.on("fn-start",function(t,e,n){e instanceof m&&("onload"===n&&(this.onload=!0),("load"===(t[0]&&t[0].type)||this.onload)&&(this.xhrCbStart=(new Date).getTime()))}),u.on("fn-end",function(t,e){this.xhrCbStart&&u.emit("xhr-cb-time",[(new Date).getTime()-this.xhrCbStart,this.onload,e],e)})}},{}],11:[function(t,e,n){e.exports=function(t){var e=document.createElement("a"),n=window.location,r={};e.href=t,r.port=e.port;var o=e.href.split("://");!r.port&&o[1]&&(r.port=o[1].split("/")[0].split("@").pop().split(":")[1]),r.port&&"0"!==r.port||(r.port="https"===o[0]?"443":"80"),r.hostname=e.hostname||n.hostname,r.pathname=e.pathname,r.protocol=o[0],"/"!==r.pathname.charAt(0)&&(r.pathname="/"+r.pathname);var i=!e.protocol||":"===e.protocol||e.protocol===n.protocol,a=e.hostname===document.domain&&e.port===n.port;return r.sameOrigin=i&&(!e.hostname||a),r}},{}],12:[function(t,e,n){function r(t,e){return function(){o(t,[(new Date).getTime()].concat(a(arguments)),null,e)}}var o=t("handle"),i=t(14),a=t(15);"undefined"==typeof window.newrelic&&(newrelic=NREUM);var s=["setPageViewName","setCustomAttribute","finished","addToTrace","inlineHit"],c=["addPageAction"],f="api-";i(s,function(t,e){newrelic[e]=r(f+e,"api")}),i(c,function(t,e){newrelic[e]=r(f+e)}),e.exports=newrelic,newrelic.noticeError=function(t){"string"==typeof t&&(t=new Error(t)),o("err",[t,(new Date).getTime()])}},{}],13:[function(t,e,n){var r=0,o=navigator.userAgent.match(/Firefox[\/\s](\d+\.\d+)/);o&&(r=+o[1]),e.exports=r},{}],14:[function(t,e,n){function r(t,e){var n=[],r="",i=0;for(r in t)o.call(t,r)&&(n[i]=e(r,t[r]),i+=1);return n}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],15:[function(t,e,n){function r(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}e.exports=r},{}],16:[function(t,e,n){function r(t){return!(t&&"function"==typeof t&&t.apply&&!t[a])}var o=t("ee"),i=t(15),a="nr@original",s=Object.prototype.hasOwnProperty,c=!1;e.exports=function(t){function e(t,e,n,o){function nrWrapper(){var r,a,s,c;try{a=this,r=i(arguments),s="function"==typeof n?n(r,a):n||{}}catch(u){d([u,"",[r,a,o],s])}f(e+"start",[r,a,o],s);try{return c=t.apply(a,r)}catch(l){throw f(e+"err",[r,a,l],s),l}finally{f(e+"end",[r,a,c],s)}}return r(t)?t:(e||(e=""),nrWrapper[a]=t,u(t,nrWrapper),nrWrapper)}function n(t,n,o,i){o||(o="");var a,s,c,f="-"===o.charAt(0);for(c=0;c<n.length;c++)s=n[c],a=t[s],r(a)||(t[s]=e(a,f?s+o:o,i,s))}function f(e,n,r){if(!c){c=!0;try{t.emit(e,n,r)}catch(o){d([o,e,n,r])}c=!1}}function u(t,e){if(Object.defineProperty&&Object.keys)try{var n=Object.keys(t);return n.forEach(function(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:function(e){return t[n]=e,e}})}),e}catch(r){d([r])}for(var o in t)s.call(t,o)&&(e[o]=t[o]);return e}function d(e){try{t.emit("internal-error",e)}catch(n){}}return t||(t=o),e.inPlace=n,e.flag=a,e}},{}],ee:[function(t,e,n){function r(){}function o(t){function e(t){return t&&t instanceof r?t:t?s(t,a,i):i()}function n(n,r,o){t&&t(n,r,o);for(var i=e(o),a=l(n),s=a.length,c=0;s>c;c++)a[c].apply(i,r);var u=f[v[n]];return u&&u.push([w,n,r,i]),i}function d(t,e){m[t]=l(t).concat(e)}function l(t){return m[t]||[]}function p(t){return u[t]=u[t]||o(n)}function h(t,e){c(t,function(t,n){e=e||"feature",v[n]=e,e in f||(f[e]=[])})}var m={},v={},w={on:d,emit:n,get:p,listeners:l,context:e,buffer:h};return w}function i(){return new r}var a="nr@context",s=t("gos"),c=t(14),f={},u={},d=e.exports=o();d.backlog=f},{}],gos:[function(t,e,n){function r(t,e,n){if(o.call(t,e))return t[e];var r=n();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(t,e,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return t[e]=r,r}var o=Object.prototype.hasOwnProperty;e.exports=r},{}],handle:[function(t,e,n){function r(t,e,n,r){o.buffer([t],r),o.emit(t,e,n)}var o=t("ee").get("handle");e.exports=r,r.ee=o},{}],id:[function(t,e,n){function r(t){var e=typeof t;return!t||"object"!==e&&"function"!==e?-1:t===window?0:a(t,i,function(){return o++})}var o=1,i="nr@id",a=t("gos");e.exports=r},{}],loader:[function(t,e,n){function r(){if(!m++){var t=h.info=NREUM.info,e=u.getElementsByTagName("script")[0];if(t&&t.licenseKey&&t.applicationID&&e){c(l,function(e,n){t[e]||(t[e]=n)});var n="https"===d.split(":")[0]||t.sslForHttp;h.proto=n?"https://":"http://",s("mark",["onload",a()],null,"api");var r=u.createElement("script");r.src=h.proto+t.agent,e.parentNode.insertBefore(r,e)}}}function o(){"complete"===u.readyState&&i()}function i(){s("mark",["domContent",a()],null,"api")}function a(){return(new Date).getTime()}var s=t("handle"),c=t(14),f=window,u=f.document;NREUM.o={ST:setTimeout,CT:clearTimeout,XHR:f.XMLHttpRequest,REQ:f.Request,EV:f.Event,PR:f.Promise,MO:f.MutationObserver},t(12);var d=""+location,l={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-943.min.js"},p=window.XMLHttpRequest&&XMLHttpRequest.prototype&&XMLHttpRequest.prototype.addEventListener&&!/CriOS/.test(navigator.userAgent),h=e.exports={offset:a(),origin:d,features:{},xhrWrappable:p};u.addEventListener?(u.addEventListener("DOMContentLoaded",i,!1),f.addEventListener("load",r,!1)):(u.attachEvent("onreadystatechange",o),f.attachEvent("onload",r)),s("mark",["firstbyte",a()],null,"api");var m=0},{}]},{},["loader",2,10,4,3]);
  </script>
  <meta content="414718878625776" property="fb:app_id"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="api.hackster.io" id="api-uri" name="api-uri"/>
  <title>
   Acoustic Localisation - Hackster.io
  </title>
  <meta content="Acoustic Localisation using TivaC Texas Instruments launchpad. Find this and other hardware projects on Hackster.io." name="description"/>
  <meta content="Acoustic Localisation" property="og:title"/>
  <meta content="Acoustic Localisation using TivaC Texas Instruments launchpad. By Graham Chow." property="og:description"/>
  <meta content="https://hackster.imgix.net/uploads/cover_image/file/81535/PA090979.JPG?w=400&amp;h=300&amp;fit=min" property="og:image"/>
  <meta content="400" property="og:image:width"/>
  <meta content="300" property="og:image:height"/>
  <meta content="https://www.hackster.io/graham_chow/acoustic-localisation-c7c8ab" property="og:url"/>
  <meta content="Hackster.io" property="og:site_name"/>
  <meta content="summary_large_image" property="twitter:card"/>
  <meta content="@hacksterio" property="twitter:site"/>
  <meta content="hackster.io" property="twitter:domain"/>
  <meta content="Acoustic Localisation" property="twitter:title"/>
  <meta content="Acoustic Localisation using TivaC Texas Instruments launchpad." property="twitter:description"/>
  <meta content="@hacksterio" property="twitter:site"/>
  <meta content="https://hackster.imgix.net/uploads/cover_image/file/81535/PA090979.JPG?w=400&amp;h=300&amp;fit=min" property="twitter:image"/>
  <link href="https://www.hackster.io/graham_chow/acoustic-localisation-c7c8ab" rel="canonical"/>
  <meta content="Acoustic Localisation,Internet of Things,Launch Pad,Servo" name="keywords"/>
  <!--Le HTML5 shim, for IE6-8 support of HTML elements-->
  <!--[if lt IE 9]
= javascript_include_tag "//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.1/html5shiv.js"-->
  <link href="/assets/application-516262377edde08b4261d9036972cea2.css" media="all" rel="stylesheet"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-57x57-9d72eb79848bfe56efcd387f35b73d07.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="57x57"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-60x60-9ddc8c9c140c7b5a8958965f723a7912.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="60x60"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-72x72-177814f5a9bc98d2d495c75fae754253.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="72x72"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-76x76-638e94948679e2a40f89236beb3dd494.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="76x76"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-114x114-860bdadfc3efedf21cfb77db32445c3e.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="114x114"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-120x120-9f3a722b5d1013df775e8def6c9f95f9.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="120x120"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-144x144-e9e6870e72a0940445a778e78659e416.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="144x144"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-152x152-b2d8bbfada35f8e01405f88652dfc321.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="152x152"/>
  <link href="https://www.hackster.io/assets/favicons/apple-touch-icon-180x180-bcf18bef0026cc1f4de0013c9ea936c4.png?v=zXX3Bm3lo3" rel="apple-touch-icon" sizes="180x180"/>
  <link href='https://www.hackster.io/assets/favicons/favicon-16x16-e8b196537848774c8931ff0837cf544b.png?v=zXX3Bm3lo3" sizes="16x16' rel="icon" type="image/png"/>
  <link href='https://www.hackster.io/assets/favicons/favicon-32x32-9ff1565cb05de42b6a00341a45dc8388.png?v=zXX3Bm3lo3" sizes="32x32' rel="icon" type="image/png"/>
  <link href='https://www.hackster.io/assets/favicons/favicon-96x96-0264dc5e95a70805369e1e758320396b.png?v=zXX3Bm3lo3" sizes="96x96' rel="icon" type="image/png"/>
  <link href='https://www.hackster.io/favicons/favicon-160x160.png?v=zXX3Bm3lo3" sizes="160x160' rel="icon" type="image/png"/>
  <link href='https://www.hackster.io/assets/favicons/android-chrome-192x192-b41826b5921f17f7cb7b2838bca63367.png?v=zXX3Bm3lo3" sizes="192x192' rel="icon" type="image/png"/>
  <link href="https://www.hackster.io/assets/favicons/manifest-e60a8b4238596aa4ce724c8ab712399d.json?v=zXX3Bm3lo3" rel="manifest"/>
  <link color="#1cacf7" href="https://www.hackster.io/assets/favicons/safari-pinned-tab-4de73e91164c13952b1b50b67ea60bb8.svg?v=zXX3Bm3lo3" rel="mask-icon"/>
  <link href="https://www.hackster.io/assets/favicons/favicon-09198796c5dad8c5694e6eefa8b31b45.ico?v=zXX3Bm3lo3" rel="shortcut icon"/>
  <meta content="#1cacf7" name="msapplication-TileColor"/>
  <meta content="https://www.hackster.io/assets/favicons/mstile-144x144-e21fba69ccb30dff38d098770ec36074.png?v=zXX3Bm3lo3" name="msapplication-TileImage"/>
  <meta content="#1cacf7" name="theme-color"/>
  <meta content="Hackster" name="apple-mobile-web-app-title"/>
  <meta content="Hackster" name="application-name"/>
  <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-11926897-15', 'auto', 'hackster');
  ga('hackster.send', 'pageview');
  ga('hackster.set', 'dimension1', 'Visitor');
  ga('hackster.set', 'dimension2', 'projects');
  ga('hackster.set', 'dimension3', 'show');
  </script>
  <script>
   !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '1055054847899682');
fbq('track', "PageView");
  </script>
  <noscript>
   <img height="1" src="https://www.facebook.com/tr?id=1055054847899682&amp;ev=PageView&amp;noscript=1" style="display:none" width="1"/>
  </noscript>
 </head>
 <body>
  <div id="outer-wrapper">
   <div class="popup-overlay modal-popup" data-width="450" id="simplified-signup-popup">
    <div class="popup-overlay-bg">
    </div>
    <div class="popup-overlay-outer">
     <div class="popup-overlay-inner">
      <button class="close" data-target="#simplified-signup-popup">
       Ã—
      </button>
      <h4>
       Please complete the following to continue:
      </h4>
      <form accept-charset="UTF-8" action="/users/simplified_registrations" class="simple_form user-form form-compact disable-on-submit text-left" id="login-form" method="post" novalidate="novalidate">
       <input name="utf8" type="hidden" value="âœ“"/>
       <input name="redirect_to" type="hidden"/>
       <input name="source" type="hidden"/>
       <div class="form-group string optional user_full_name full-name-wrapper" style="display:none;">
        <label class="string optional control-label" for="user_full_name">
         First name and last name:
        </label>
        <input class="string optional form-control" id="user_full_name" maxlength="255" name="user[full_name]" size="255" type="text"/>
       </div>
       <div class="form-group email optional user_email">
        <label class="email optional control-label" for="user_email">
         Email:
        </label>
        <input class="string email optional form-control form-control" id="user_email" maxlength="255" name="user[email]" size="255" type="email" value=""/>
       </div>
       <input class="btn btn-primary btn btn-primary btn-block" name="commit" type="submit" value="Continue"/>
      </form>
      <p>
       <small>
        Already have an account?
        <a class="sign-in-link show-login-form" href="/users/sign_in">
         Sign in
        </a>
       </small>
      </p>
     </div>
    </div>
   </div>
   <div class="popup-overlay modal-popup modal-remove" data-width="800" id="signup-popup">
    <div class="popup-overlay-bg">
    </div>
    <div class="popup-overlay-outer">
     <div class="popup-overlay-inner has-columns">
      <div class="popup-left-column">
       <p style="font-size: 1.3em">
        <strong>
         Hackster is the community dedicated to learning hardware
        </strong>
       </p>
       <p>
        Join to:
       </p>
       <ul class="text-left">
        <li>
         Earn free hardware from the Free Store
        </li>
        <li>
         Win prizes by participating in contests
        </li>
        <li>
         Be notified of new projects that match your interests
        </li>
       </ul>
      </div>
      <div class="popup-right-column">
       <button class="close" data-target="#signup-popup">
        Ã—
       </button>
       <form accept-charset="UTF-8" action="/users" class="simple_form form-compact disable-on-submit user-form" id="signup-popup-email" method="post" novalidate="novalidate">
        <input name="utf8" type="hidden" value="âœ“"/>
        <input name="redirect_to" type="hidden" value="/graham_chow/acoustic-localisation-c7c8ab"/>
        <input name="source" type="hidden" value="popup"/>
        <div class="form-group email optional user_email">
         <input class="string email optional form-control form-control" id="user_email" maxlength="255" name="user[email]" placeholder="Email" size="255" type="email" value=""/>
        </div>
        <div class="form-group password optional user_password">
         <input class="password optional form-control" id="user_password" maxlength="128" name="user[password]" placeholder="Password" size="128" type="password"/>
        </div>
        <input class="btn btn-primary btn btn-primary btn-block" name="commit" type="submit" value="Create my free account"/>
       </form>
       <div style="position:relative; margin-bottom: 20px">
        <div class="hr">
         or
        </div>
       </div>
       <a class="zocial zocial-block facebook" href="https://www.hackster.io/users/auth/facebook?redirect_host=www.hackster.io&amp;redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab">
        Connect with Facebook
       </a>
       <p class="small">
        <a href="/users/sign_up?highlight=connect&amp;redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab&amp;source=popup">
         Prefer connecting using another social account?
        </a>
       </p>
       <p class="small" style="margin-bottom:0">
        Already have an account?
        <a href="/users/sign_in?redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab">
         Sign in
        </a>
       </p>
      </div>
     </div>
    </div>
   </div>
   <div class="navbar navbar-default navbar-static-top" id="navigation">
    <div class="hide-on-desktop fa fa-bars" id="nav-mobile-trigger">
    </div>
    <div class="navbar-in" style="position:relative;">
     <div class="navbar-header">
      <a class="navbar-brand navbar-btn" href="/" title="Hackster.io">
       <img alt="Hackster.io" src="/assets/hackster_logo_blue-566d9b31578764a926f1b9083441df30.png"/>
      </a>
     </div>
     <div class="show-on-desktop" id="nav-non-logo">
      <ul class="top-menu-nav" id="nav-actions">
       <li class="dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
         Projects
        </a>
        <ul class="dropdown-menu" id="topnav">
         <li>
          <div class="row">
           <div class="col-xs-12">
            <div class="text-center mg-20">
             <a class="btn btn-block btn-primary" href="/projects?ref=topnav">
              Browse all projects
             </a>
            </div>
            <ul class="nav nav-pills nav-stacked">
             <li class="title">
              <h4>
               Popular tags
              </h4>
             </li>
             <li>
              <a href="/arduino?ref=topnav">
               Arduino
              </a>
             </li>
             <li>
              <a href="/tags/bluetooth?ref=topnav">
               Bluetooth
              </a>
             </li>
             <li>
              <a href="/tags/display?ref=topnav">
               Display
              </a>
             </li>
             <li>
              <a href="/tags/embedded?ref=topnav">
               Embedded
              </a>
             </li>
             <li>
              <a href="/tags/home+automation?ref=topnav">
               Home automation
              </a>
             </li>
             <li>
              <a href="/tags/internet+of+things?ref=topnav">
               IoT
              </a>
             </li>
             <li>
              <a href="/intel/products/intel-edison?ref=topnav">
               Intel Edison
              </a>
             </li>
             <li>
              <a href="/tags/led?ref=topnav">
               LED
              </a>
             </li>
             <li>
              <a href="/microsoft/products/microsoft-azure?ref=topnav">
               Microsoft Azure
              </a>
             </li>
             <li>
              <a href="/particle?ref=topnav">
               Particle
              </a>
             </li>
             <li>
              <a href="/raspberry-pi?ref=topnav">
               Raspberry Pi
              </a>
             </li>
             <li>
              <a href="/tessel?ref=topnav">
               Tessel
              </a>
             </li>
             <li>
              <a href="/tags/wifi?ref=topnav">
               Wifi
              </a>
             </li>
             <li>
              <a href="/tags/wearable?ref=topnav">
               Wearable
              </a>
             </li>
             <li>
              <a href="/microsoft/products/windows-10-iot-core?ref=topnav">
               Windows 10
              </a>
             </li>
            </ul>
           </div>
          </div>
         </li>
        </ul>
       </li>
       <li>
        <a class="nav-link" href="/platforms">
         Platforms
        </a>
       </li>
       <li>
        <a class="nav-link" href="/challenges">
         Challenges
        </a>
       </li>
       <li>
        <a class="nav-link" href="/live">
         Live
        </a>
       </li>
      </ul>
      <ul class="clearfix" id="navbar-right">
       <li>
        <a class="login-link" href="/users/sign_up?source=nav">
         Sign up
        </a>
       </li>
       <li>
        <a class="btn btn-primary login-link" href="/users/sign_in" id="show-login-form">
         Log in
        </a>
       </li>
      </ul>
      <ul class="navbar-right top-menu-nav" id="left-nav">
      </ul>
      <div id="navbar-search">
       <form action="/search" class="navbar-form" method="get">
        <div class="form-group">
         <div class="input-group">
          <span class="input-group-addon">
           <i class="fa fa-search">
           </i>
          </span>
          <input class="form-control" id="search-input" name="q" placeholder="Search" type="text"/>
         </div>
        </div>
       </form>
      </div>
     </div>
    </div>
   </div>
   <div id="main">
    <div class="project-page project-page-single-column project-13358" id="content">
     <div class="popup-overlay modal-popup" id="embed-popup">
      <div class="popup-overlay-bg">
      </div>
      <div class="popup-overlay-outer">
       <div class="popup-overlay-inner">
        <button class="close unselectable" data-effect="fade" data-target="#embed-popup">
         Ã—
        </button>
        <h3>
         Embed the widget on your own site
        </h3>
        <div id="project-embed">
         <p>
          Add the following snippet to your HTML:
          <textarea class="embed-code" onclick="this.select();" type="text">
           <iframe frameborder="0" height="327.5" scrolling="no" src="https://www.hackster.io/graham_chow/acoustic-localisation-c7c8ab/embed?use_route=project" width="350">
           </iframe>
          </textarea>
         </p>
         <div class="project-embed-thumb">
          <div class="project-card">
           <div class="card-image">
            <img alt="Acoustic Localisation" class="cover-img" src="https://hackster.imgix.net/uploads/cover_image/file/81535/PA090979.JPG?w=400&amp;h=300&amp;fit=min"/>
            <a class="link-overlay project-link-with-ref" href="https://www.hackster.io/graham_chow/acoustic-localisation-c7c8ab" target="_blank">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                1,171
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                18
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <p>
              Acoustic Localisation using TivaC Texas Instruments launchpad.
             </p>
             <p>
              Read up about this project on
              <img alt="Hackster.io" class="hackster-logo" src="/assets/hackster_logo_text-02f4bff5a045ab5849f1fcdec0c83422.png" title="Hackster is a community dedicated to learning hardware, from beginner to pro."/>
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="https://www.hackster.io/graham_chow/acoustic-localisation-c7c8ab">
              Acoustic Localisation
             </a>
            </h4>
            <p>
             <span class="user-name">
              <a href="https://www.hackster.io/graham_chow">
               Graham Chow
              </a>
             </span>
            </p>
           </div>
          </div>
         </div>
         <div class="clearfix">
         </div>
        </div>
       </div>
      </div>
     </div>
     <a class="project-switcher previous" href="/projects/13358/next?dir=prev&amp;offset=2&amp;ref=similar&amp;ref_id=9991" rel="nofollow" title="Previous project">
      <div class="inner">
       <i class="fa fa-chevron-left">
       </i>
      </div>
     </a>
     <a class="project-switcher next" href="/projects/13358/next?dir=next&amp;offset=2&amp;ref=similar&amp;ref_id=9991" rel="nofollow" title="Next project">
      <div class="inner">
       <i class="fa fa-chevron-right">
       </i>
      </div>
     </a>
     <section class="section-teaser">
      <div class="container-desktop container">
       <div id="home">
        <div class="project-title">
         <h1>
          Acoustic Localisation
         </h1>
         <ul class="list-with-dividers project-credits">
          <li>
           Made by
           <a href="/graham_chow">
            Graham Chow
           </a>
          </li>
          <li>
           Published in
           <a href="/lists/communication">
            Communication
           </a>
           ,
           <a href="/microsoft">
            Microsoft
           </a>
           , and
           <a href="/ti-launchpad">
            TI LaunchPad
           </a>
          </li>
         </ul>
        </div>
        <div class="row project-teaser">
         <div class="col-md-7 col-md-offset-0-5 left-column">
          <div class="project-banner" style="background-image: url('https://hackster.imgix.net/uploads/cover_image/file/81535/PA090979.JPG?w=900&amp;h=675&amp;fit=min')">
          </div>
         </div>
         <div class="col-md-4 right-column">
          <div class="container-mobile">
           <section class="section-thumbs">
            <h4>
             About this project
            </h4>
            <p class="project-one-liner">
             Acoustic Localisation using TivaC Texas Instruments launchpad.
            </p>
            <ul class="list-inline tags">
             <li class="tag-link">
              <i class="fa fa-tag">
              </i>
              <span>
               <a href="/projects/tags/acoustic+localisation">
                acoustic localisation
               </a>
              </span>
             </li>
             <li class="tag-link">
              <i class="fa fa-tag">
              </i>
              <span>
               <a href="/projects/tags/internet+of+things">
                internet of things
               </a>
              </span>
             </li>
             <li class="tag-link">
              <i class="fa fa-tag">
              </i>
              <span>
               <a href="/projects/tags/launch+pad">
                launch pad
               </a>
              </span>
             </li>
             <li class="tag-link">
              <i class="fa fa-tag">
              </i>
              <span>
               <a href="/projects/tags/servo">
                servo
               </a>
              </span>
             </li>
            </ul>
           </section>
           <section class="section-thumbs">
            <h4>
             Project info
            </h4>
            <div class="info-table">
             <div class="info-row">
              <div class="info-label">
               Difficulty
              </div>
              <div class="info">
               <a class="project-difficulty text-danger" href="/projects?difficulty=advanced">
                Advanced
               </a>
              </div>
             </div>
             <div class="info-row">
              <div class="info-label">
               Published
              </div>
              <div class="info">
               October 13, 2015
              </div>
             </div>
             <div class="info-row">
              <div class="info-label">
               License
              </div>
              <div class="info">
               <a href="http://opensource.org/licenses/MIT" target="_blank">
                MIT
               </a>
              </div>
             </div>
            </div>
           </section>
           <section class="section-thumbs" id="respects-section">
            <ul class="list-inline text-muted small project-stats-inline">
             <li class="impression-stats istooltip" title="Views">
              <i class="fa fa-eye">
              </i>
              <span class="stat-figure">
               1,154
              </span>
             </li>
             <li class="respect-stats istooltip" title="Respects">
              <i class="fa fa-thumbs-o-up">
              </i>
              <span class="stat-figure">
               18
              </span>
             </li>
            </ul>
            <div class="respecting-faces">
             <img alt="Af672c156692b3c6720821ffddfff56a" class="user-img img-circle" src="//gravatar.com/avatar/af672c156692b3c6720821ffddfff56a.png?d=retro&amp;s=60"/>
             <img alt="Fb profile" class="user-img img-circle" src="https://hackster.imgix.net/uploads/avatar/file/74964/fb-profile.jpg?w=60&amp;h=60&amp;fit=min&amp;fm=jpg"/>
             <img alt="0c48a85" class="user-img img-circle" src="https://hackster.imgix.net/uploads/avatar/file/49036/0c48a85.jpg?w=60&amp;h=60&amp;fit=min&amp;fm=jpg"/>
             <img alt="Mike" class="user-img img-circle" src="https://hackster.imgix.net/uploads/avatar/file/68283/mike.jpg?w=60&amp;h=60&amp;fit=min&amp;fm=jpg"/>
             <img alt="800x800" class="user-img img-circle" src="https://hackster.imgix.net/uploads/avatar/file/46119/800x800.jpg?w=60&amp;h=60&amp;fit=min&amp;fm=jpg"/>
             <img alt="E4edccdb0a4f00615e612d061787c723" class="user-img img-circle" src="//gravatar.com/avatar/e4edccdb0a4f00615e612d061787c723.png?d=retro&amp;s=60"/>
             <img alt="1070825 10201658716414701 16442639 o copy" class="user-img img-circle" src="https://hackster.imgix.net/uploads/avatar/file/48353/1070825_10201658716414701_16442639_o_copy.jpg?w=60&amp;h=60&amp;fit=min&amp;fm=jpg"/>
             <img alt="6054c89122f3cd12b68c7b4e558af3a8" class="user-img img-circle" src="//gravatar.com/avatar/6054c89122f3cd12b68c7b4e558af3a8.png?d=retro&amp;s=60"/>
             <img alt="A16e45c8c9456a7601b60925641beab6" class="user-img img-circle" src="//gravatar.com/avatar/a16e45c8c9456a7601b60925641beab6.png?d=retro&amp;s=60"/>
            </div>
           </section>
           <section class="section-thumbs">
            <div class="primary-action-container">
             <div class="async-respect-btn-placeholder">
             </div>
            </div>
            <div class="secondary-actions-container">
             <a class="btn btn-sm btn-secondary" href="/users/sign_in?redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab">
              <i class="fa fa-bookmark-o">
              </i>
              <span>
               Bookmark
              </span>
             </a>
             <a class="btn btn-secondary btn-sm" data-content="&lt;div class='sharing-actions'&gt;&lt;ul&gt;&lt;li&gt;&lt;a class='social-share-link clearfix' data-url='https://www.facebook.com/dialog/feed?app_id=543757942384158&amp;amp;link=https%3A%2F%2Fwww.hackster.io%2Fgraham_chow%2Facoustic-localisation-c7c8ab&amp;amp;name=Acoustic+Localisation&amp;amp;description=I+love+this%3A+Acoustic+Localisation+by+Graham+Chow&amp;amp;picture=https%3A%2F%2Fhackster.imgix.net%2Fuploads%2Fcover_image%2Ffile%2F81535%2FPA090979.JPG%3Fw%3D400%26h%3D300%26fit%3Dmin&amp;amp;redirect_uri=http%3A%2F%2Ffacebook.com' href=''&gt;&lt;i class='fa fa-facebook'&gt;&lt;/i&gt;&lt;span&gt;Share on Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='social-share-link clearfix' data-url='https://twitter.com/intent/tweet?text=I+love+this%3A+Acoustic+Localisation+by+Graham+Chow&amp;amp;url=https%3A%2F%2Fwww.hackster.io%2Fgraham_chow%2Facoustic-localisation-c7c8ab' href=''&gt;&lt;i class='fa fa-twitter'&gt;&lt;/i&gt;&lt;span&gt;Share on Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" data-html="true" data-placement="bottom" data-toggle="popover" data-trigger="click">
              <i class="fa fa-share-square-o">
              </i>
              <span>
               Share
              </span>
             </a>
             <a class="btn btn-secondary btn-sm modal-open" data-target="#embed-popup" href="javascript:void(0)">
              <i class="fa fa-code">
              </i>
              <span>
               Embed
              </span>
             </a>
            </div>
           </section>
          </div>
         </div>
        </div>
       </div>
      </div>
     </section>
     <section class="section-description">
      <div class="container">
       <div class="row">
        <div class="col-md-7 col-md-offset-0-5 left-column container-mobile">
         <section class="section-container" id="things">
          <h2 class="section-title">
           <span class="title title-toggle">
            Things used in this project
           </span>
          </h2>
          <div class="section-content">
           <div class="title">
            <strong>
             Hardware components:
            </strong>
           </div>
           <table class="sortable-table table table-hover fields-container">
            <tbody>
             <tr class="fields part-row" id="part-15944">
              <td class="part-img">
               <img alt="Ek tm4c123gxl tivalp angle new" src="https://hackster.imgix.net/uploads/image/file/61204/ek-tm4c123gxl_tivalp_angle_new.jpg?w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff&amp;fm=jpg"/>
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   <a href="/ti-launchpad/products/ek-tm4c123gxl-launchpad">
                    TI LaunchPad EK-TM4C123GXL LaunchPad
                   </a>
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="width:30px;text-align:center;vertical-align:middle">
               Ã—
              </td>
              <td style="width:10%;min-width:20px;text-align:center;vertical-align:middle">
               1
              </td>
              <td style="text-align:right">
               <a class="istooltip" href="https://store.ti.com/Tiva-C-LaunchPad.aspx" rel="nofollow" style="color:#333" target="_blank" title="Buy">
                <i class="fa fa-shopping-cart">
                </i>
               </a>
              </td>
             </tr>
             <tr class="fields part-row" id="part-15945">
              <td class="part-img">
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   opamps
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="width:30px;text-align:center;vertical-align:middle">
               Ã—
              </td>
              <td style="width:10%;min-width:20px;text-align:center;vertical-align:middle">
               1
              </td>
              <td style="text-align:right">
              </td>
             </tr>
             <tr class="fields part-row" id="part-15946">
              <td class="part-img">
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   Microphone with preamps
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="width:30px;text-align:center;vertical-align:middle">
               Ã—
              </td>
              <td style="width:10%;min-width:20px;text-align:center;vertical-align:middle">
               2
              </td>
              <td style="text-align:right">
              </td>
             </tr>
             <tr class="fields part-row" id="part-15947">
              <td class="part-img">
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   Personal Computer
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="width:30px;text-align:center;vertical-align:middle">
               Ã—
              </td>
              <td style="width:10%;min-width:20px;text-align:center;vertical-align:middle">
               1
              </td>
              <td style="text-align:right">
              </td>
             </tr>
             <tr class="fields part-row" id="part-15948">
              <td class="part-img">
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   Servo Motor
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="width:30px;text-align:center;vertical-align:middle">
               Ã—
              </td>
              <td style="width:10%;min-width:20px;text-align:center;vertical-align:middle">
               1
              </td>
              <td style="text-align:right">
              </td>
             </tr>
            </tbody>
           </table>
           <div class="title">
            <strong>
             Software apps and online services:
            </strong>
           </div>
           <table class="sortable-table table table-hover fields-container">
            <tbody>
             <tr class="fields part-row" id="part-15950">
              <td class="part-img">
               <img alt="10" src="https://hackster.imgix.net/uploads/image/file/51079/10.png?w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff"/>
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   <a href="/microsoft/products/windows-10-iot-core">
                    Microsoft Windows 10 IoT Core
                   </a>
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="text-align:right">
               <a class="istooltip" href="https://dev.windows.com/en-us/iot" rel="nofollow" style="color:#333" target="_blank" title="More info">
                <i class="fa fa-link">
                </i>
               </a>
              </td>
             </tr>
             <tr class="fields part-row" id="part-15983">
              <td class="part-img">
               <img alt="Vs2015logo" src="https://hackster.imgix.net/uploads/image/file/79739/vs2015logo.jpg?w=48&amp;h=48&amp;fit=fill&amp;bg=ffffff&amp;fm=jpg"/>
              </td>
              <td>
               <table style="width:100%">
                <tbody>
                 <tr>
                  <td>
                   <a href="/microsoft/products/visual-studio-2015">
                    Microsoft Visual Studio 2015
                   </a>
                  </td>
                 </tr>
                 <tr>
                  <td style="color: #888;font-size:75%;">
                  </td>
                 </tr>
                </tbody>
               </table>
              </td>
              <td style="text-align:right">
               <a class="istooltip" href="https://www.visualstudio.com/en-us/products/vs-2015-product-editions.aspx" rel="nofollow" style="color:#333" target="_blank" title="More info">
                <i class="fa fa-link">
                </i>
               </a>
              </td>
             </tr>
            </tbody>
           </table>
          </div>
         </section>
         <section class="section-container collapsed" id="about-project">
          <h2 class="section-title">
           <span class="title title-toggle">
            Story
           </span>
          </h2>
          <div class="section-content hljs-active">
           <div class="medium-editor">
            <p>
             Having a little bit of experience in signal processing and stuff, I thought I might try out acoustic localisation using microphones.
            </p>
            <p>
             The setup is straightforward and we use it all the time to determine locations of sounds through our ears. The difference of course is that this is being done by using "cheap" off-the-shelf components from ebay, so this makes it all good in theory, but does it actually work? Cutting to the chase, it is a definite yes.
            </p>
            <div class="embed-frame" data-caption="Acoustic Localisation in Action" data-type="url" data-url="https://youtu.be/bctGrlky2-0">
             <div class="figure youtube">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
               Acoustic Localisation in Action
              </div>
              <div class="embed widescreen" contenteditable="false">
               <iframe allowfullscreen="" frameborder="0" height="100%" src="//www.youtube.com/embed/bctGrlky2-0?rel=0" width="100%">
               </iframe>
              </div>
             </div>
            </div>
            <p>
             <br/>
            </p>
            <h4>
             Front End
            </h4>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38065">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81539" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38065,0);">
                    <img alt="max9812 microphone" src="https://hackster.imgix.net/uploads/image/file/81539/microphone.jpg?w=680&amp;h=510&amp;fit=max&amp;fm=jpg"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="max9812 microphone">
                    max9812 microphone
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81539">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38065] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81539/microphone.jpg?w=1280&h=960&fit=max&fm=jpg',
          caption: 'max9812 microphone',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             The front end consists of two microphone modules based upon the max9812 chip that give a fixed gain of 20dB. Ideally it would be better if the gain was somehow programmable, because I'm using the 12bit ADCs (analogue to digital converters) on the launchpad. The signals are fed into an op amp based 2nd order low pass filter. This is a low pass filter for anti aliasing that is required when using ADCs. Naturally I had cheap ceramic capacitors rated at +/- 20% of their value, so hmmm. I used four 1uF decoupling capacitors and biased at 1.65V for input to the ADC.
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38073">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81547" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38073,0);">
                    <img alt="Analogue filter" src="https://hackster.imgix.net/uploads/image/file/81547/filter.png?w=680&amp;h=510&amp;fit=max"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="Analogue filter">
                    Analogue filter
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81547">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38073] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81547/filter.png?w=1280&h=960&fit=max',
          caption: 'Analogue filter',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             <br/>
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38066">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81540" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38066,0);">
                    <img alt="Analogue Lowpass Filter" src="https://hackster.imgix.net/uploads/image/file/81540/frontend.jpg?w=680&amp;h=510&amp;fit=max&amp;fm=jpg"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="Analogue Lowpass Filter">
                    Analogue Lowpass Filter
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81540">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38066] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81540/frontend.jpg?w=1280&h=960&fit=max&fm=jpg',
          caption: 'Analogue Lowpass Filter',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             My biggest problem with my front end was noise from the servo, both electrical and mechanical. To address this issue, I separated the ground and the power (the servo uses 5V in any case). I also loaded up the bread board with a dozen or so capacitors between ground and 3.3V. Incidentally, I used a second op amp to convert the 3.3V servo signal to 5V by driving the op amp to the rail.
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38067">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81541" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38067,0);">
                    <img alt="Tiva C" src="https://hackster.imgix.net/uploads/image/file/81541/tivac.jpg?w=680&amp;h=510&amp;fit=max&amp;fm=jpg"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="Tiva C">
                    Tiva C
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81541">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38067] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81541/tivac.jpg?w=1280&h=960&fit=max&fm=jpg',
          caption: 'Tiva C',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <h4>
             TivaC
            </h4>
            <p>
             The TivaC is a Texas Instruments launchpad board that runs a TM4C123GH6PM processor that has a 80Mhz 32 bit Cortex-M4 core.
            </p>
            <p>
             The TM4C123GH6PM has actually only 2 physical ADCs, but you can multiplex the input signals to each of them so as in this case, they are processing eight inputs each. I'm running both at max speed (1 mega sample per second each), adding them both together, doing an 8 times hardware averaging, and doing a micro DMA to get to the digital filtering stage.
            </p>
            <p>
             The digital filter runs on a circular buffer and uses 63 taps. The filter is designed to filter out above 4kHz to remove noise.
            </p>
            <p>
             From there it goes straight into the USB buffer to be sent out as soon as it gets the request from the PC.
            </p>
            <p>
             The USB protocol I am using is very very simple. The PC sends the Tiva a 6 byte packet consisting of the servo position and how many bytes it wants. The Tiva responds with a packet of 16 bit ADC values (in practice a packet of 8192 bytes about 30 times per second).
            </p>
            <p>
             The TivaC is also configured to spit out debug info from the uart. This proved invaluable in rooting out buffer overflows.
            </p>
            <p>
             It also drives a PWM signal to the servo.
            </p>
            <p>
             I've included a copy of the main code that drives the TivaC so you can get an idea how it is done.
            </p>
            <h4>
             PC software
            </h4>
            <p>
             The USB driver I am using is the WinUSB with TI's Generic Bulk Device driver.
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38068">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81542" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38068,0);">
                    <img alt="TI's generic bulk device USB driver" src="https://hackster.imgix.net/uploads/image/file/81542/USB%20Driver.jpg?w=680&amp;h=510&amp;fit=max&amp;fm=jpg"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="TI's generic bulk device USB driver">
                    TI's generic bulk device USB driver
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81542">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38068] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81542/USB%20Driver.jpg?w=1280&h=960&fit=max&fm=jpg',
          caption: 'TI\'s generic bulk device USB driver',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             The actual PC software is in written as both a native C++ DLL (that connects to the device and does the time domain correlation) and a C# based user interface exe. The C# exe uses "interop" to connect to the native DLL. Of course the PC is running Windows 10, not sure whether that means Windows IOT, but I guess in this broad definition of IoT, call it maybe.
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38069">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81543" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38069,0);">
                    <img alt="Tracker App" src="https://hackster.imgix.net/uploads/image/file/81543/trackerapp.png?w=680&amp;h=510&amp;fit=max"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="Tracker App">
                    Tracker App
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81543">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38069] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81543/trackerapp.png?w=1280&h=960&fit=max',
          caption: 'Tracker App',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             Cross correlation in the time domain is very simple. It is simply a number of running sums of the two microphone signals multiplied with each other with each a different time delay. The time delay that produces the highest sum is the peak and from that a phase delay between the two signals can be determined.
            </p>
            <p>
             correlation (time, n) =Â correlation (time - 1, n) * decay + microphone_left(time) * microphone_right(time-n) where n is the phase delay
            </p>
            <div class="embed-frame" data-caption="" data-type="widget" data-widget-id="38070">
             <div class="figure image_widget">
              <div class="figcaption embed-figcaption" data-contenteditable="true" data-default-text="Type in a caption" data-disable-toolbar="true">
              </div>
              <div class="embed original" contenteditable="false">
               <div class="image-gallery-container">
                <div class="image-gallery">
                 <div class="image" contenteditable="false" data-file-id="81544" data-type="file">
                  <figure>
                   <a class="embed-img" href="javascript:openLightBox(38070,0);">
                    <img alt="Left and Right Microphone phase delay" src="https://hackster.imgix.net/uploads/image/file/81544/signals.png?w=680&amp;h=510&amp;fit=max"/>
                   </a>
                   <figcaption class="widget-attribute widget-attribute-editable" data-attribute="[images_attributes][0][title]" data-default-text="Type in a caption for this image" data-disable-toolbar="true" data-value="Left and Right Microphone phase delay">
                    Left and Right Microphone phase delay
                   </figcaption>
                   <span class="widget-attribute" data-attribute="[images_attributes][0][id]" data-value="81544">
                   </span>
                   <span class="widget-attribute position" data-attribute="[images_attributes][0][position]" data-value="1">
                   </span>
                  </figure>
                 </div>
                </div>
               </div>
               <script>
                if (typeof(lightBoxImages) == 'undefined') {
  lightBoxImages = {};
}
lightBoxImages[38070] = [{
          URL: 'https://hackster.imgix.net/uploads/image/file/81544/signals.png?w=1280&h=960&fit=max',
          caption: 'Left and Right Microphone phase delay',
          type: 'image'
      }];
               </script>
              </div>
             </div>
            </div>
            <p>
             The high sample rate of near 16kHz allows a resolution of around 2 degrees.
            </p>
            <p>
             I'm usingÂ Markov probabilistic chaining to combine the belief that the sound source is likely not to have moved. This seems to work well enough. Obviously multiple microphones (hence the 8 channels) would be better.
            </p>
           </div>
          </div>
          <div class="read-more">
           <a class="btn btn-primary" href="javascript:void(0)">
            Read more
           </a>
          </div>
         </section>
         <section class="section-container section-collapsible" id="schematics">
          <h2 class="section-title">
           <a class="title title-toggle" href="">
            Schematics
            <i class="fa fa-chevron-down">
            </i>
            <i class="fa fa-chevron-up">
            </i>
           </a>
          </h2>
          <div class="section-content">
           <div class="repository">
            <div class="button-content-container">
             <div class="button-content">
              <h5>
               Analogue Filter
              </h5>
              <div class="buttons">
               <a class="btn btn-primary btn-sm" href="https://halckemy.s3.amazonaws.com/uploads/image_file/file/81546/filter.png">
                Download
               </a>
              </div>
             </div>
            </div>
            <div class="embed original">
             <img alt="Filter" src="https://halckemy.s3.amazonaws.com/uploads/image_file/file/81546/filter.png"/>
            </div>
           </div>
          </div>
         </section>
         <section class="section-container" id="code">
          <h2 class="section-title">
           <span class="title title-toggle">
            Code
           </span>
          </h2>
          <div class="section-content">
           <div class="code-widgets single-file ">
            <div class="sidebar">
             <ul>
              <li>
               <a class="active" data-target="#code-widget-38071" href="javascript:void(0)">
                Main Code for TivaC
               </a>
              </li>
             </ul>
            </div>
            <div class="preview-container">
             <div class="preview-pane active" id="code-widget-38071">
              <div class="preview-header">
               <div class="clearfix">
                <h5>
                 Main Code for TivaC
                 <small>
                  C/C++
                 </small>
                </h5>
                <div class="buttons btn-group btn-group-default">
                 <button class="btn btn-primary btn-xs copy-code istooltip" data-container="body" data-trigger="hover" title="Copy the code">
                  <i class="fa fa-clipboard">
                  </i>
                 </button>
                 <a class="btn btn-primary btn-xs" data-container="body" href="/code_files/38071/download" rel="tooltip" title="Download">
                  <i class="fa fa-cloud-download">
                  </i>
                 </a>
                </div>
               </div>
              </div>
              <div class="preview-body pygments-syntax all">
               <div class="highlight">
                <pre><span id="line-1"><span class="cp">#include &lt;stdint.h&gt;</span>
</span><span id="line-2"><span class="cp">#include &lt;string.h&gt;</span>
</span><span id="line-3"><span class="cp">#include &lt;stdbool.h&gt;</span>
</span><span id="line-4"><span class="cp">#include "inc/hw_memmap.h"</span>
</span><span id="line-5"><span class="cp">#include "inc/hw_ints.h"</span>
</span><span id="line-6"><span class="cp">#include "inc/hw_types.h"</span>
</span><span id="line-7"><span class="cp">#include "inc/hw_adc.h"</span>
</span><span id="line-8"><span class="cp">#include "driverlib/pin_map.h"</span>
</span><span id="line-9"><span class="cp">#include "driverlib/debug.h"</span>
</span><span id="line-10"><span class="cp">#include "driverlib/sysctl.h"</span>
</span><span id="line-11"><span class="cp">#include "driverlib/adc.h"</span>
</span><span id="line-12"><span class="cp">#include "driverlib/rom.h"</span>
</span><span id="line-13"><span class="cp">#include "driverlib/interrupt.h"</span>
</span><span id="line-14"><span class="cp">#include "driverlib/gpio.h"</span>
</span><span id="line-15"><span class="cp">#include "driverlib/timer.h"</span>
</span><span id="line-16"><span class="cp">#include "driverlib/udma.h"</span>
</span><span id="line-17"><span class="cp">#include "driverlib/uart.h"</span>
</span><span id="line-18"><span class="cp">#include "usblib/usblib.h"</span>
</span><span id="line-19"><span class="cp">#include "usblib/usb-ids.h"</span>
</span><span id="line-20"><span class="cp">#include "usblib/device/usbdevice.h"</span>
</span><span id="line-21"><span class="cp">#include "usblib/device/usbdbulk.h"</span>
</span><span id="line-22"><span class="cp">#include "utils/uartstdio.h"</span>
</span><span id="line-23"><span class="cp">#include "utils/ustdlib.h"</span>
</span><span id="line-24"><span class="cp">#include "usb_bulk_structs.h"</span>
</span><span id="line-25"><span class="cp">#include "driverlib/pwm.h"</span>
</span><span id="line-26"><span class="cp">#include "global_def.h"</span>
</span><span id="line-27"><span class="cm">/*</span>
</span><span id="line-28"><span class="cm"> * main.c</span>
</span><span id="line-29"><span class="cm"> */</span>
</span><span id="line-30">
</span><span id="line-31"><span class="cp">#define PWM_FREQUENCY (50)</span>
</span><span id="line-32"><span class="cp">#define PWM_MIN (30)</span>
</span><span id="line-33"><span class="cp">#define PWM_MAX (120)</span>
</span><span id="line-34"><span class="cp">#define PWM_ZERO (75)</span>
</span><span id="line-35">
</span><span id="line-36"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">g_ui32DMAErrCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-37"><span class="kt">void</span> <span class="nf">InitADC00</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span id="line-38"><span class="kt">void</span> <span class="nf">ConfigureUART</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</span><span id="line-39">
</span><span id="line-40"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">bool</span> <span class="n">g_bUSBConfigured</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-41">
</span><span id="line-42"><span class="cp">#pragma DATA_ALIGN(g_adcPingPong0, 64)</span>
</span><span id="line-43"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_adcPingPong0</span><span class="p">[</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">][</span><span class="n">NUM_CHANNELS</span><span class="p">];</span>
</span><span id="line-44"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_adcInIndex0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-45"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_adcOutIndex0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-46"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">int32_t</span> <span class="n">g_stall0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-47"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">int32_t</span> <span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span><span id="line-48">
</span><span id="line-49"><span class="cp">#pragma DATA_ALIGN(g_adcPingPong1, 64)</span>
</span><span id="line-50"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_adcPingPong1</span><span class="p">[</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">][</span><span class="n">NUM_CHANNELS</span><span class="p">];</span>
</span><span id="line-51"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_adcInIndex1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-52"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">int32_t</span> <span class="n">g_stall1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-53"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">int32_t</span> <span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span><span id="line-54">
</span><span id="line-55"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">g_msg_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-56"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">g_usb_receive_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-57"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">int32_t</span> <span class="n">g_usb_bytes_to_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-58">
</span><span id="line-59"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">g_ui32Load</span><span class="p">;</span>
</span><span id="line-60"><span class="k">static</span> <span class="kt">uint32_t</span> <span class="n">g_ui32PWMClock</span><span class="p">;</span>
</span><span id="line-61"><span class="k">static</span> <span class="kt">uint8_t</span> <span class="n">g_ui8Adjust</span> <span class="o">=</span> <span class="n">PWM_ZERO</span><span class="p">;</span>
</span><span id="line-62"><span class="k">static</span> <span class="k">volatile</span> <span class="kt">uint8_t</span> <span class="n">g_ui8AdjustPending</span> <span class="o">=</span> <span class="n">PWM_ZERO</span><span class="p">;</span>
</span><span id="line-63">
</span><span id="line-64"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="n">NUM_CHANNELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span><span id="line-65"><span class="k">static</span> <span class="kt">int16_t</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="n">NUM_CHANNELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span><span id="line-66"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_channelOffsetCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-67"><span class="k">static</span> <span class="kt">uint8_t</span> <span class="n">g_fire</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-68">
</span><span id="line-69">
</span><span id="line-70">
</span><span id="line-71"><span class="k">static</span> <span class="kt">int32_t</span> <span class="n">g_filter</span><span class="p">[</span><span class="n">FILTER_SIZE</span><span class="p">]</span> <span class="o">=</span>
</span><span id="line-72"><span class="p">{</span>
</span><span id="line-73">		<span class="mi">2158</span>	<span class="p">,</span>
</span><span id="line-74">		<span class="o">-</span><span class="mi">3620</span>	<span class="p">,</span>
</span><span id="line-75">		<span class="o">-</span><span class="mi">7100</span>	<span class="p">,</span>
</span><span id="line-76">		<span class="o">-</span><span class="mi">4486</span>	<span class="p">,</span>
</span><span id="line-77">		<span class="mi">1833</span>	<span class="p">,</span>
</span><span id="line-78">		<span class="mi">2758</span>	<span class="p">,</span>
</span><span id="line-79">		<span class="o">-</span><span class="mi">2365</span>	<span class="p">,</span>
</span><span id="line-80">		<span class="o">-</span><span class="mi">3667</span>	<span class="p">,</span>
</span><span id="line-81">		<span class="mi">2091</span>	<span class="p">,</span>
</span><span id="line-82">		<span class="mi">4641</span>	<span class="p">,</span>
</span><span id="line-83">		<span class="o">-</span><span class="mi">1618</span>	<span class="p">,</span>
</span><span id="line-84">		<span class="o">-</span><span class="mi">5790</span>	<span class="p">,</span>
</span><span id="line-85">		<span class="mi">807</span>	<span class="p">,</span>
</span><span id="line-86">		<span class="mi">7030</span>	<span class="p">,</span>
</span><span id="line-87">		<span class="mi">412</span>	<span class="p">,</span>
</span><span id="line-88">		<span class="o">-</span><span class="mi">8308</span>	<span class="p">,</span>
</span><span id="line-89">		<span class="o">-</span><span class="mi">2119</span>	<span class="p">,</span>
</span><span id="line-90">		<span class="mi">9586</span>	<span class="p">,</span>
</span><span id="line-91">		<span class="mi">4462</span>	<span class="p">,</span>
</span><span id="line-92">		<span class="o">-</span><span class="mi">10802</span>	<span class="p">,</span>
</span><span id="line-93">		<span class="o">-</span><span class="mi">7643</span>	<span class="p">,</span>
</span><span id="line-94">		<span class="mi">11929</span>	<span class="p">,</span>
</span><span id="line-95">		<span class="mi">12065</span>	<span class="p">,</span>
</span><span id="line-96">		<span class="o">-</span><span class="mi">12913</span>	<span class="p">,</span>
</span><span id="line-97">		<span class="o">-</span><span class="mi">18596</span>	<span class="p">,</span>
</span><span id="line-98">		<span class="mi">13723</span>	<span class="p">,</span>
</span><span id="line-99">		<span class="mi">29512</span>	<span class="p">,</span>
</span><span id="line-100">		<span class="o">-</span><span class="mi">14331</span>	<span class="p">,</span>
</span><span id="line-101">		<span class="o">-</span><span class="mi">53266</span>	<span class="p">,</span>
</span><span id="line-102">		<span class="mi">14702</span>	<span class="p">,</span>
</span><span id="line-103">		<span class="mi">166092</span>	<span class="p">,</span>
</span><span id="line-104">		<span class="mi">247319</span>	<span class="p">,</span>
</span><span id="line-105">		<span class="mi">166092</span>	<span class="p">,</span>
</span><span id="line-106">		<span class="mi">14702</span>	<span class="p">,</span>
</span><span id="line-107">		<span class="o">-</span><span class="mi">53266</span>	<span class="p">,</span>
</span><span id="line-108">		<span class="o">-</span><span class="mi">14331</span>	<span class="p">,</span>
</span><span id="line-109">		<span class="mi">29512</span>	<span class="p">,</span>
</span><span id="line-110">		<span class="mi">13723</span>	<span class="p">,</span>
</span><span id="line-111">		<span class="o">-</span><span class="mi">18596</span>	<span class="p">,</span>
</span><span id="line-112">		<span class="o">-</span><span class="mi">12913</span>	<span class="p">,</span>
</span><span id="line-113">		<span class="mi">12065</span>	<span class="p">,</span>
</span><span id="line-114">		<span class="mi">11929</span>	<span class="p">,</span>
</span><span id="line-115">		<span class="o">-</span><span class="mi">7643</span>	<span class="p">,</span>
</span><span id="line-116">		<span class="o">-</span><span class="mi">10802</span>	<span class="p">,</span>
</span><span id="line-117">		<span class="mi">4462</span>	<span class="p">,</span>
</span><span id="line-118">		<span class="mi">9586</span>	<span class="p">,</span>
</span><span id="line-119">		<span class="o">-</span><span class="mi">2119</span>	<span class="p">,</span>
</span><span id="line-120">		<span class="o">-</span><span class="mi">8308</span>	<span class="p">,</span>
</span><span id="line-121">		<span class="mi">412</span>	<span class="p">,</span>
</span><span id="line-122">		<span class="mi">7030</span>	<span class="p">,</span>
</span><span id="line-123">		<span class="mi">807</span>	<span class="p">,</span>
</span><span id="line-124">		<span class="o">-</span><span class="mi">5790</span>	<span class="p">,</span>
</span><span id="line-125">		<span class="o">-</span><span class="mi">1618</span>	<span class="p">,</span>
</span><span id="line-126">		<span class="mi">4641</span>	<span class="p">,</span>
</span><span id="line-127">		<span class="mi">2091</span>	<span class="p">,</span>
</span><span id="line-128">		<span class="o">-</span><span class="mi">3667</span>	<span class="p">,</span>
</span><span id="line-129">		<span class="o">-</span><span class="mi">2365</span>	<span class="p">,</span>
</span><span id="line-130">		<span class="mi">2758</span>	<span class="p">,</span>
</span><span id="line-131">		<span class="mi">1833</span>	<span class="p">,</span>
</span><span id="line-132">		<span class="o">-</span><span class="mi">4486</span>	<span class="p">,</span>
</span><span id="line-133">		<span class="o">-</span><span class="mi">7100</span>	<span class="p">,</span>
</span><span id="line-134">		<span class="o">-</span><span class="mi">3620</span>	<span class="p">,</span>
</span><span id="line-135">		<span class="mi">2158</span>
</span><span id="line-136"><span class="p">};</span>
</span><span id="line-137">
</span><span id="line-138"><span class="c1">// uDMA control table aligned to 1024-byte boundary</span>
</span><span id="line-139"><span class="cp">#pragma DATA_ALIGN(pui8ControlTable, 1024)</span>
</span><span id="line-140"><span class="kt">uint8_t</span> <span class="n">pui8ControlTable</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span><span id="line-141">
</span><span id="line-142">
</span><span id="line-143"><span class="cp">#if ((ADC_BUFFER_SIZE * (ADC_BUFFER_WINDOW_COUNT - 1)) &lt; FILTER_SIZE)</span>
</span><span id="line-144"><span class="n">error</span>
</span><span id="line-145"><span class="cp">#endif</span>
</span><span id="line-146">
</span><span id="line-147"><span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-148"><span class="p">{</span>
</span><span id="line-149">	<span class="c1">//uint32_t ui32Period;</span>
</span><span id="line-150">	<span class="n">SysCtlClockSet</span><span class="p">(</span><span class="n">SYSCTL_SYSDIV_2_5</span><span class="o">|</span><span class="n">SYSCTL_USE_PLL</span><span class="o">|</span><span class="n">SYSCTL_OSC_MAIN</span><span class="o">|</span><span class="n">SYSCTL_XTAL_16MHZ</span><span class="p">);</span>
</span><span id="line-151">	<span class="n">SysCtlPWMClockSet</span><span class="p">(</span><span class="n">SYSCTL_PWMDIV_64</span><span class="p">);</span>
</span><span id="line-152">
</span><span id="line-153">	<span class="c1">// configure USB</span>
</span><span id="line-154">    <span class="n">ROM_SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOD</span><span class="p">);</span>
</span><span id="line-155">    <span class="n">ROM_GPIOPinTypeUSBAnalog</span><span class="p">(</span><span class="n">GPIO_PORTD_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_4</span> <span class="o">|</span> <span class="n">GPIO_PIN_5</span><span class="p">);</span>
</span><span id="line-156">
</span><span id="line-157">	<span class="n">ConfigureUART</span><span class="p">();</span>
</span><span id="line-158">
</span><span id="line-159">	<span class="c1">// gpio</span>
</span><span id="line-160">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOB</span><span class="p">);</span>
</span><span id="line-161">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOD</span><span class="p">);</span>
</span><span id="line-162">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOE</span><span class="p">);</span>
</span><span id="line-163">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOF</span><span class="p">);</span>
</span><span id="line-164">	<span class="n">GPIOPinTypeGPIOOutput</span><span class="p">(</span><span class="n">GPIO_PORTF_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_1</span><span class="o">|</span><span class="n">GPIO_PIN_2</span><span class="o">|</span><span class="n">GPIO_PIN_3</span><span class="p">);</span>
</span><span id="line-165">	<span class="n">GPIOPinTypeGPIOOutput</span><span class="p">(</span><span class="n">GPIO_PORTB_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_7</span><span class="p">);</span>
</span><span id="line-166">	<span class="n">GPIOPinWrite</span><span class="p">(</span><span class="n">GPIO_PORTB_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_7</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-167">
</span><span id="line-168">	<span class="c1">// configure pwm</span>
</span><span id="line-169">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_PWM0</span><span class="p">);</span>
</span><span id="line-170">	<span class="n">GPIOPinTypePWM</span><span class="p">(</span><span class="n">GPIO_PORTB_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_6</span><span class="p">);</span>
</span><span id="line-171">	<span class="n">GPIOPinConfigure</span><span class="p">(</span><span class="n">GPIO_PB6_M0PWM0</span><span class="p">);</span>
</span><span id="line-172">	<span class="n">g_ui32PWMClock</span> <span class="o">=</span> <span class="n">SysCtlClockGet</span><span class="p">()</span> <span class="o">/</span> <span class="mi">64</span><span class="p">;</span>
</span><span id="line-173">	<span class="n">g_ui32Load</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_ui32PWMClock</span> <span class="o">/</span> <span class="n">PWM_FREQUENCY</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="line-174">	<span class="n">PWMGenConfigure</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_GEN_0</span><span class="p">,</span> <span class="n">PWM_GEN_MODE_DOWN</span><span class="p">);</span>
</span><span id="line-175">	<span class="n">PWMGenPeriodSet</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_GEN_0</span><span class="p">,</span> <span class="n">g_ui32Load</span><span class="p">);</span>
</span><span id="line-176">
</span><span id="line-177">	<span class="n">PWMPulseWidthSet</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_OUT_0</span><span class="p">,</span> <span class="n">g_ui8Adjust</span> <span class="o">*</span> <span class="n">g_ui32Load</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span><span id="line-178">	<span class="n">PWMOutputState</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_OUT_0_BIT</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</span><span id="line-179">	<span class="n">PWMGenEnable</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_GEN_0</span><span class="p">);</span>
</span><span id="line-180">
</span><span id="line-181">	<span class="c1">// usb</span>
</span><span id="line-182">	<span class="n">g_bUSBConfigured</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-183">    <span class="n">USBBufferInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-184">    <span class="n">USBBufferInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sRxBuffer</span><span class="p">);</span>
</span><span id="line-185">    <span class="n">USBStackModeSet</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">eUSBModeForceDevice</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-186">    <span class="n">USBDBulkInit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">g_sBulkDevice</span><span class="p">);</span>
</span><span id="line-187">
</span><span id="line-188">	<span class="c1">// dma</span>
</span><span id="line-189">	<span class="n">SysCtlPeripheralClockGating</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span><span id="line-190">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_UDMA</span><span class="p">);</span>
</span><span id="line-191">	<span class="n">SysCtlPeripheralSleepEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_UDMA</span><span class="p">);</span>
</span><span id="line-192">	<span class="n">IntEnable</span><span class="p">(</span><span class="n">INT_UDMAERR</span><span class="p">);</span>
</span><span id="line-193">	<span class="n">uDMAEnable</span><span class="p">();</span>
</span><span id="line-194">	<span class="n">uDMAControlBaseSet</span><span class="p">(</span><span class="n">pui8ControlTable</span><span class="p">);</span>
</span><span id="line-195">
</span><span id="line-196">	<span class="c1">// adc</span>
</span><span id="line-197">	<span class="n">InitADC00</span><span class="p">();</span>
</span><span id="line-198">
</span><span id="line-199">	<span class="n">IntMasterEnable</span><span class="p">();</span>
</span><span id="line-200">
</span><span id="line-201">	<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"ADC USB</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</span><span id="line-202">
</span><span id="line-203">	<span class="n">tUSBRingBufObject</span> <span class="n">sTxRing</span><span class="p">;</span>
</span><span id="line-204">	<span class="kt">uint32_t</span> <span class="n">ui32Space</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ui32Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ui32HeaderIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-205">	<span class="kt">bool</span> <span class="n">header_reserved</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-206">	<span class="kt">bool</span> <span class="n">overflow</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-207">
</span><span id="line-208">	<span class="n">USBBufferInfoGet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sTxRing</span><span class="p">);</span>
</span><span id="line-209">	<span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="n">sTxRing</span><span class="p">.</span><span class="n">ui32WriteIndex</span> <span class="o">%</span> <span class="n">BULK_TX_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-210">	<span class="n">ui32Space</span> <span class="o">=</span> <span class="n">USBBufferSpaceAvailable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-211">
</span><span id="line-212">
</span><span id="line-213">	<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"=============================</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</span><span id="line-214">	<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"begin: wi:%d sp:%d.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ui32WriteIndex</span><span class="p">,</span> <span class="n">ui32Space</span><span class="p">);</span>
</span><span id="line-215">
</span><span id="line-216">	<span class="c1">//int16_t debug = 1;</span>
</span><span id="line-217">	<span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
</span><span id="line-218">	<span class="p">{</span>
</span><span id="line-219">		<span class="kt">int32_t</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">;</span>
</span><span id="line-220">		<span class="kt">bool</span> <span class="n">samples_added</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-221">
</span><span id="line-222">		<span class="c1">///////////////////////////////////////////////////////////////////////</span>
</span><span id="line-223">		<span class="c1">// add header if necessary</span>
</span><span id="line-224">		<span class="k">if</span><span class="p">((</span><span class="n">header_reserved</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ui32Space</span> <span class="o">&gt;</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">))</span>
</span><span id="line-225">		<span class="p">{</span>
</span><span id="line-226">			<span class="n">header_reserved</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span><span id="line-227">			<span class="n">ui32Space</span> <span class="o">-=</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">;</span>
</span><span id="line-228">			<span class="n">ui32HeaderIndex</span> <span class="o">=</span> <span class="n">ui32WriteIndex</span><span class="p">;</span>
</span><span id="line-229">			<span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">ui32WriteIndex</span> <span class="o">+</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">)</span> <span class="o">%</span> <span class="n">BULK_TX_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-230">		<span class="p">}</span>
</span><span id="line-231">
</span><span id="line-232">		<span class="c1">///////////////////////////////////////////////////////////////////////</span>
</span><span id="line-233">		<span class="c1">// adc 0</span>
</span><span id="line-234">		<span class="n">r0</span> <span class="o">=</span> <span class="n">g_adcOutIndex0</span> <span class="o">/</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-235">		<span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span><span class="p">((</span><span class="n">FILTER_SIZE</span> <span class="o">-</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">;</span>
</span><span id="line-236">		<span class="n">r1</span> <span class="o">=</span> <span class="p">(</span><span class="n">r0</span> <span class="o">+</span> <span class="n">offset</span><span class="p">)</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span>
</span><span id="line-237">
</span><span id="line-238">		<span class="k">if</span><span class="p">((</span><span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">))</span>
</span><span id="line-239">		<span class="p">{</span>
</span><span id="line-240">			<span class="k">if</span><span class="p">(</span><span class="n">ui32Space</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">BULK_BLOCK_SIZE</span> <span class="o">*</span> <span class="n">ADC_DECIMATED_BUFFER_SIZE</span><span class="p">))</span>
</span><span id="line-241">			<span class="p">{</span>
</span><span id="line-242">				<span class="k">if</span><span class="p">((</span><span class="n">overflow</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">g_usb_bytes_to_read</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="line-243">				<span class="p">{</span>
</span><span id="line-244">					<span class="n">GPIOPinWrite</span><span class="p">(</span><span class="n">GPIO_PORTF_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</span><span id="line-245">					<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">ADC_DECIMATED_BUFFER_SIZE</span><span class="p">;</span><span class="n">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-246">					<span class="p">{</span>
</span><span id="line-247">						<span class="c1">// filter</span>
</span><span id="line-248">						<span class="kt">int32_t</span> <span class="n">accum</span><span class="p">[</span><span class="n">NUM_CHANNELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
</span><span id="line-249">						<span class="kt">int32_t</span> <span class="o">*</span><span class="n">filter</span> <span class="o">=</span> <span class="n">g_filter</span><span class="p">;</span>
</span><span id="line-250">						<span class="kt">int32_t</span> <span class="o">*</span><span class="n">src</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="n">g_adcOutIndex0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-251">						<span class="kt">int32_t</span> <span class="n">count</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">FILTER_SIZE</span><span class="p">,</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span> <span class="o">-</span> <span class="n">g_adcOutIndex0</span><span class="p">));</span>
</span><span id="line-252">						<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">count</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-253">						<span class="p">{</span>
</span><span id="line-254">							<span class="kt">int32_t</span> <span class="n">f</span> <span class="o">=</span> <span class="o">*</span><span class="n">filter</span><span class="p">;</span>
</span><span id="line-255">							<span class="n">accum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-256">							<span class="n">accum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-257">							<span class="n">accum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-258">							<span class="n">accum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-259">							<span class="n">accum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-260">							<span class="n">accum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-261">							<span class="n">accum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-262">							<span class="n">accum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-263">							<span class="n">filter</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-264">						<span class="p">}</span>
</span><span id="line-265">						<span class="kt">int32_t</span> <span class="n">next_count</span> <span class="o">=</span> <span class="n">FILTER_SIZE</span> <span class="o">-</span> <span class="n">count</span><span class="p">;</span>
</span><span id="line-266">						<span class="n">src</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-267">						<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">next_count</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-268">						<span class="p">{</span>
</span><span id="line-269">							<span class="kt">int32_t</span> <span class="n">f</span> <span class="o">=</span> <span class="o">*</span><span class="n">filter</span><span class="p">;</span>
</span><span id="line-270">							<span class="n">accum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-271">							<span class="n">accum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-272">							<span class="n">accum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-273">							<span class="n">accum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-274">							<span class="n">accum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-275">							<span class="n">accum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-276">							<span class="n">accum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-277">							<span class="n">accum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span> <span class="o">*</span> <span class="n">f</span><span class="p">;</span>
</span><span id="line-278">							<span class="n">filter</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-279">						<span class="p">}</span>
</span><span id="line-280">
</span><span id="line-281">						<span class="c1">// add to usb buffer</span>
</span><span id="line-282">						<span class="kt">int16_t</span> <span class="o">*</span><span class="n">usb_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int16_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">g_pui8USBTxBuffer</span><span class="p">[</span><span class="n">ui32WriteIndex</span><span class="p">];</span>
</span><span id="line-283">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-284">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-285">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-286">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-287">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-288">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-289">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-290">						<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">accum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span>
</span><span id="line-291">						<span class="n">ui32Count</span> <span class="o">+=</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">;</span>
</span><span id="line-292">						<span class="n">ui32Space</span> <span class="o">-=</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">;</span>
</span><span id="line-293">						<span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">ui32WriteIndex</span> <span class="o">+</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">)</span> <span class="o">%</span> <span class="n">BULK_TX_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-294">						<span class="n">g_adcOutIndex0</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcOutIndex0</span> <span class="o">+</span> <span class="n">DECIMATION_INC</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-295">					<span class="p">}</span>
</span><span id="line-296">					<span class="n">samples_added</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span><span id="line-297">					<span class="n">GPIOPinWrite</span><span class="p">(</span><span class="n">GPIO_PORTF_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_1</span><span class="o">|</span><span class="n">GPIO_PIN_2</span><span class="o">|</span><span class="n">GPIO_PIN_3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-298">				<span class="p">}</span>
</span><span id="line-299">			<span class="p">}</span>
</span><span id="line-300">			<span class="k">else</span>
</span><span id="line-301">			<span class="p">{</span>
</span><span id="line-302">				<span class="c1">// run out of space, reset</span>
</span><span id="line-303">				<span class="n">header_reserved</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-304">	            <span class="n">USBBufferFlush</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-305">				<span class="n">USBBufferInfoGet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sTxRing</span><span class="p">);</span>
</span><span id="line-306">				<span class="n">ui32Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-307">				<span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="n">sTxRing</span><span class="p">.</span><span class="n">ui32WriteIndex</span> <span class="o">%</span> <span class="n">BULK_TX_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-308">				<span class="n">ui32Space</span> <span class="o">=</span> <span class="n">USBBufferSpaceAvailable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-309">				<span class="n">header_reserved</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-310">				<span class="n">overflow</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span><span id="line-311">				<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"overflow sp:%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ui32Space</span><span class="p">);</span>
</span><span id="line-312">			<span class="p">}</span>
</span><span id="line-313">			<span class="k">if</span><span class="p">(</span><span class="n">samples_added</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
</span><span id="line-314">			<span class="p">{</span>
</span><span id="line-315">				<span class="n">g_adcOutIndex0</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcOutIndex0</span> <span class="o">+</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-316">			<span class="p">}</span>
</span><span id="line-317">			<span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-318">
</span><span id="line-319">			<span class="k">if</span><span class="p">(</span><span class="n">g_ui8AdjustPending</span> <span class="o">!=</span> <span class="n">g_ui8Adjust</span><span class="p">)</span>
</span><span id="line-320">			<span class="p">{</span>
</span><span id="line-321">				<span class="k">if</span><span class="p">(</span><span class="n">g_ui8AdjustPending</span> <span class="o">&lt;</span> <span class="n">g_ui8Adjust</span><span class="p">)</span>
</span><span id="line-322">				<span class="p">{</span>
</span><span id="line-323">					<span class="n">g_ui8Adjust</span><span class="o">--</span><span class="p">;</span>
</span><span id="line-324">					<span class="n">PWMPulseWidthSet</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_OUT_0</span><span class="p">,</span> <span class="n">g_ui8Adjust</span> <span class="o">*</span> <span class="n">g_ui32Load</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span><span id="line-325">				<span class="p">}</span>
</span><span id="line-326">				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">g_ui8AdjustPending</span> <span class="o">&gt;</span> <span class="n">g_ui8Adjust</span><span class="p">)</span>
</span><span id="line-327">				<span class="p">{</span>
</span><span id="line-328">					<span class="n">g_ui8Adjust</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-329">					<span class="n">PWMPulseWidthSet</span><span class="p">(</span><span class="n">PWM0_BASE</span><span class="p">,</span> <span class="n">PWM_OUT_0</span><span class="p">,</span> <span class="n">g_ui8Adjust</span> <span class="o">*</span> <span class="n">g_ui32Load</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span><span id="line-330">				<span class="p">}</span>
</span><span id="line-331">			<span class="p">}</span>
</span><span id="line-332">			<span class="n">GPIOPinWrite</span><span class="p">(</span><span class="n">GPIO_PORTB_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_7</span><span class="p">,</span> <span class="n">g_fire</span> <span class="o">?</span> <span class="n">GPIO_PIN_7</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-333">		<span class="p">}</span>
</span><span id="line-334">		<span class="k">else</span>
</span><span id="line-335">		<span class="p">{</span>
</span><span id="line-336">			<span class="k">for</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="line-337">			<span class="p">{</span>
</span><span id="line-338">				<span class="k">if</span><span class="p">((</span><span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">))</span>
</span><span id="line-339">				<span class="p">{</span>
</span><span id="line-340">					<span class="kt">int32_t</span> <span class="o">*</span><span class="n">src0</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">ADC_BUFFER_SIZE</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-341">					<span class="kt">int32_t</span> <span class="o">*</span><span class="n">src1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_adcPingPong1</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">ADC_BUFFER_SIZE</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-342">					<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">ADC_BUFFER_SIZE</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-343">					<span class="p">{</span>
</span><span id="line-344">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-345">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span><span id="line-346">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span id="line-347">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span><span id="line-348">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span><span id="line-349">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span id="line-350">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span id="line-351">						<span class="o">*</span><span class="n">src0</span> <span class="o">+=</span> <span class="o">*</span><span class="n">src1</span><span class="o">++</span> <span class="o">-</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="n">g_channelSum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">-=</span> <span class="o">*</span><span class="n">src0</span><span class="p">;</span> <span class="o">*</span><span class="n">src0</span><span class="o">++</span> <span class="o">+=</span> <span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
</span><span id="line-352">					<span class="p">}</span>
</span><span id="line-353">					<span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span id="line-354">					<span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-355">					<span class="n">g_channelOffsetCount</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-356">				<span class="p">}</span>
</span><span id="line-357">			<span class="p">}</span>
</span><span id="line-358">			<span class="k">if</span><span class="p">(</span><span class="n">g_channelOffsetCount</span> <span class="o">&gt;</span> <span class="n">CHANNEL_OFFSET_AVERAGE_COUNT</span><span class="p">)</span>
</span><span id="line-359">			<span class="p">{</span>
</span><span id="line-360">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-361">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-362">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-363">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-364">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-365">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-366">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-367">				<span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_channelOffset</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)(</span><span class="n">g_channelSum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">/</span> <span class="n">CHANNEL_OFFSET_AVERAGE_DIVISOR</span><span class="p">);</span>
</span><span id="line-368">				<span class="n">g_channelOffsetCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-369">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-370">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-371">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-372">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-373">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-374">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-375">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-376">				<span class="n">g_channelSum</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-377">			<span class="p">}</span>
</span><span id="line-378">		<span class="p">}</span>
</span><span id="line-379">
</span><span id="line-380">		<span class="c1">///////////////////////////////////////////////////////////////////////</span>
</span><span id="line-381">		<span class="c1">// process USB if necessary</span>
</span><span id="line-382">		<span class="k">if</span><span class="p">(</span><span class="n">samples_added</span><span class="p">)</span>
</span><span id="line-383">		<span class="p">{</span>
</span><span id="line-384">			<span class="c1">// flush usb buffer..</span>
</span><span id="line-385">			<span class="kt">int32_t</span> <span class="n">usb_want</span> <span class="o">=</span> <span class="n">g_usb_bytes_to_read</span> <span class="o">-</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">;</span>
</span><span id="line-386">			<span class="kt">int32_t</span> <span class="n">high_water</span> <span class="o">=</span> <span class="p">(</span><span class="n">USB_HIGH_WATER_MULTIPLIER</span> <span class="o">*</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">);</span>
</span><span id="line-387">			<span class="kt">int32_t</span> <span class="n">target_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">usb_want</span><span class="p">,</span> <span class="n">high_water</span><span class="p">);</span>
</span><span id="line-388">			<span class="k">if</span><span class="p">((</span><span class="n">ui32Count</span> <span class="o">==</span> <span class="n">target_size</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">target_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="line-389">			<span class="p">{</span>
</span><span id="line-390">				<span class="c1">// add in header</span>
</span><span id="line-391">				<span class="kt">int8_t</span> <span class="o">*</span><span class="n">usb_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int8_t</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">g_pui8USBTxBuffer</span><span class="p">[</span><span class="n">ui32HeaderIndex</span><span class="p">];</span>
</span><span id="line-392">				<span class="c1">// 16 byte header</span>
</span><span id="line-393">				<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xAA</span><span class="p">;</span>
</span><span id="line-394">				<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xAA</span><span class="p">;</span>
</span><span id="line-395">				<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_size</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
</span><span id="line-396">				<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_size</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
</span><span id="line-397">				<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">12</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-398">					<span class="o">*</span><span class="n">usb_ptr</span><span class="o">++</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-399">
</span><span id="line-400">				<span class="n">USBBufferDataWritten</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">,</span> <span class="n">target_size</span> <span class="o">+</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">);</span>
</span><span id="line-401">
</span><span id="line-402">				<span class="n">header_reserved</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-403">				<span class="n">overflow</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-404">				<span class="n">IntMasterDisable</span><span class="p">();</span>
</span><span id="line-405">				<span class="n">g_usb_bytes_to_read</span> <span class="o">-=</span> <span class="p">(</span><span class="n">target_size</span> <span class="o">+</span> <span class="n">BULK_BLOCK_SIZE</span><span class="p">);</span>
</span><span id="line-406">				<span class="k">if</span><span class="p">(</span><span class="n">g_usb_bytes_to_read</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-407">					<span class="n">g_usb_bytes_to_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-408">				<span class="n">IntMasterEnable</span><span class="p">();</span>
</span><span id="line-409">				<span class="c1">// get usb status</span>
</span><span id="line-410">				<span class="n">USBBufferInfoGet</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sTxRing</span><span class="p">);</span>
</span><span id="line-411">				<span class="n">ui32WriteIndex</span> <span class="o">=</span> <span class="n">sTxRing</span><span class="p">.</span><span class="n">ui32WriteIndex</span> <span class="o">%</span> <span class="n">BULK_TX_BUFFER_SIZE</span><span class="p">;</span>
</span><span id="line-412">				<span class="n">ui32Space</span> <span class="o">=</span> <span class="n">USBBufferSpaceAvailable</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-413">				<span class="n">ui32Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-414">			<span class="p">}</span>
</span><span id="line-415">		<span class="p">}</span>
</span><span id="line-416">		<span class="k">else</span>
</span><span id="line-417">		<span class="p">{</span>
</span><span id="line-418">			<span class="k">if</span><span class="p">(</span><span class="n">g_stall0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-419">			<span class="p">{</span>
</span><span id="line-420">				<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"stall 0:%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">g_stall0</span><span class="p">);</span>
</span><span id="line-421">				<span class="n">g_stall0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-422">			<span class="p">}</span>
</span><span id="line-423">			<span class="k">if</span><span class="p">(</span><span class="n">g_stall1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-424">			<span class="p">{</span>
</span><span id="line-425">				<span class="n">UARTprintf</span><span class="p">(</span><span class="s">"stall 1:%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">g_stall1</span><span class="p">);</span>
</span><span id="line-426">				<span class="n">g_stall1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-427">			<span class="p">}</span>
</span><span id="line-428">		<span class="p">}</span>
</span><span id="line-429">	<span class="p">}</span>
</span><span id="line-430"><span class="p">}</span>
</span><span id="line-431">
</span><span id="line-432"><span class="kt">void</span> <span class="n">Timer0IntHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-433"><span class="p">{</span>
</span><span id="line-434">	<span class="c1">// Clear the timer interrupt</span>
</span><span id="line-435">	<span class="n">TimerIntClear</span><span class="p">(</span><span class="n">TIMER0_BASE</span><span class="p">,</span> <span class="n">TIMER_TIMA_TIMEOUT</span><span class="p">);</span>
</span><span id="line-436">	<span class="c1">// Read the current state of the GPIO pin and</span>
</span><span id="line-437">	<span class="c1">// write back the opposite state</span>
</span><span id="line-438">	<span class="cm">/*</span>
</span><span id="line-439"><span class="cm">	if(GPIOPinRead(GPIO_PORTF_BASE, GPIO_PIN_2))</span>
</span><span id="line-440"><span class="cm">	{</span>
</span><span id="line-441"><span class="cm">		GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_1|GPIO_PIN_2|GPIO_PIN_3, 0);</span>
</span><span id="line-442"><span class="cm">	}</span>
</span><span id="line-443"><span class="cm">	else</span>
</span><span id="line-444"><span class="cm">	{</span>
</span><span id="line-445"><span class="cm">		GPIOPinWrite(GPIO_PORTF_BASE, GPIO_PIN_2, 4);</span>
</span><span id="line-446"><span class="cm">	}</span>
</span><span id="line-447"><span class="cm">	*/</span>
</span><span id="line-448"><span class="p">}</span>
</span><span id="line-449">
</span><span id="line-450"><span class="kt">void</span> <span class="n">uDMAErrorHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-451"><span class="p">{</span>
</span><span id="line-452">	<span class="kt">uint32_t</span> <span class="n">ui32Status</span><span class="p">;</span>
</span><span id="line-453">	<span class="n">ui32Status</span> <span class="o">=</span> <span class="n">uDMAErrorStatusGet</span><span class="p">();</span>
</span><span id="line-454">	<span class="k">if</span><span class="p">(</span><span class="n">ui32Status</span><span class="p">)</span>
</span><span id="line-455">	<span class="p">{</span>
</span><span id="line-456">		<span class="n">uDMAErrorStatusClear</span><span class="p">();</span>
</span><span id="line-457">		<span class="n">g_ui32DMAErrCount</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-458">	<span class="p">}</span>
</span><span id="line-459"><span class="p">}</span>
</span><span id="line-460">
</span><span id="line-461"><span class="c1">// ADC interrupt handler. Called on completion of uDMA transfer</span>
</span><span id="line-462"><span class="kt">void</span> <span class="n">ADC00IntHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-463"><span class="p">{</span>
</span><span id="line-464">    <span class="kt">uint32_t</span> <span class="n">ui32ModeP</span><span class="p">;</span>
</span><span id="line-465">    <span class="kt">uint32_t</span> <span class="n">ui32ModeA</span><span class="p">;</span>
</span><span id="line-466">
</span><span id="line-467">    <span class="n">ADCIntClear</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-468">
</span><span id="line-469">    <span class="n">ui32ModeP</span> <span class="o">=</span> <span class="n">uDMAChannelModeGet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">);</span>
</span><span id="line-470">    <span class="k">if</span><span class="p">(</span><span class="n">ui32ModeP</span> <span class="o">==</span> <span class="n">UDMA_MODE_STOP</span><span class="p">)</span>
</span><span id="line-471">    <span class="p">{</span>
</span><span id="line-472">        <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-473">                                   <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-474">								   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC0_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-475">								   <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="n">g_adcInIndex0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-476">        <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span><span class="p">);</span>
</span><span id="line-477">        <span class="n">g_adcInIndex0</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-478">        <span class="k">if</span><span class="p">((</span><span class="n">g_adcInIndex0</span> <span class="o">%</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-479">        <span class="p">{</span>
</span><span id="line-480">        	<span class="kt">int32_t</span> <span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex0</span> <span class="o">/</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">);</span>
</span><span id="line-481">        	<span class="k">if</span><span class="p">(</span><span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">ready_buffer</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-482">        		<span class="n">g_stall0</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-483">       		<span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ready_buffer</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">)</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span>
</span><span id="line-484">       		<span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">ready_buffer</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="line-485">        <span class="p">}</span>
</span><span id="line-486">    <span class="p">}</span>
</span><span id="line-487">    <span class="k">else</span>
</span><span id="line-488">    <span class="p">{</span>
</span><span id="line-489">    	<span class="n">ui32ModeA</span> <span class="o">=</span> <span class="n">uDMAChannelModeGet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">);</span>
</span><span id="line-490">		<span class="k">if</span><span class="p">(</span><span class="n">ui32ModeA</span> <span class="o">==</span> <span class="n">UDMA_MODE_STOP</span><span class="p">)</span>
</span><span id="line-491">		<span class="p">{</span>
</span><span id="line-492">			<span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-493">									   <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-494">									   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC0_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-495">									   <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="n">g_adcInIndex0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-496">			<span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span><span class="p">);</span>
</span><span id="line-497">			<span class="n">g_adcInIndex0</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-498">			<span class="k">if</span><span class="p">((</span><span class="n">g_adcInIndex0</span> <span class="o">%</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-499">			<span class="p">{</span>
</span><span id="line-500">				<span class="kt">int32_t</span> <span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex0</span> <span class="o">/</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">);</span>
</span><span id="line-501">				<span class="k">if</span><span class="p">(</span><span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">ready_buffer</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-502">					<span class="n">g_stall0</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-503">				<span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ready_buffer</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">)</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span>
</span><span id="line-504">				<span class="n">g_adcPingPongStage0</span><span class="p">[</span><span class="n">ready_buffer</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="line-505">			<span class="p">}</span>
</span><span id="line-506">		<span class="p">}</span>
</span><span id="line-507">    <span class="p">}</span>
</span><span id="line-508"><span class="p">}</span>
</span><span id="line-509">
</span><span id="line-510"><span class="c1">// ADC interrupt handler. Called on completion of uDMA transfer</span>
</span><span id="line-511"><span class="kt">void</span> <span class="n">ADC10IntHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-512"><span class="p">{</span>
</span><span id="line-513">    <span class="kt">uint32_t</span> <span class="n">ui32ModeP</span><span class="p">;</span>
</span><span id="line-514">    <span class="kt">uint32_t</span> <span class="n">ui32ModeA</span><span class="p">;</span>
</span><span id="line-515">
</span><span id="line-516">    <span class="n">ADCIntClear</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-517">
</span><span id="line-518">    <span class="n">ui32ModeP</span> <span class="o">=</span> <span class="n">uDMAChannelModeGet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">);</span>
</span><span id="line-519">
</span><span id="line-520">    <span class="k">if</span><span class="p">(</span><span class="n">ui32ModeP</span> <span class="o">==</span> <span class="n">UDMA_MODE_STOP</span><span class="p">)</span>
</span><span id="line-521">    <span class="p">{</span>
</span><span id="line-522">        <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-523">                                   <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-524">								   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC1_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-525">								   <span class="o">&amp;</span><span class="n">g_adcPingPong1</span><span class="p">[</span><span class="n">g_adcInIndex1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-526">        <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span><span class="p">);</span>
</span><span id="line-527">        <span class="n">g_adcInIndex1</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-528">        <span class="k">if</span><span class="p">((</span><span class="n">g_adcInIndex1</span> <span class="o">%</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-529">        <span class="p">{</span>
</span><span id="line-530">        	<span class="kt">int32_t</span> <span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex1</span> <span class="o">/</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">);</span>
</span><span id="line-531">        	<span class="k">if</span><span class="p">(</span><span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">ready_buffer</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-532">        		<span class="n">g_stall1</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-533">       		<span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ready_buffer</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">)</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span>
</span><span id="line-534">       		<span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">ready_buffer</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="line-535">        <span class="p">}</span>
</span><span id="line-536">    <span class="p">}</span>
</span><span id="line-537">    <span class="k">else</span>
</span><span id="line-538">    <span class="p">{</span>
</span><span id="line-539">    	<span class="n">ui32ModeA</span> <span class="o">=</span> <span class="n">uDMAChannelModeGet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">);</span>
</span><span id="line-540">		<span class="k">if</span><span class="p">(</span><span class="n">ui32ModeA</span> <span class="o">==</span> <span class="n">UDMA_MODE_STOP</span><span class="p">)</span>
</span><span id="line-541">		<span class="p">{</span>
</span><span id="line-542">			<span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-543">									   <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-544">									   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC1_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-545">									   <span class="o">&amp;</span><span class="n">g_adcPingPong1</span><span class="p">[</span><span class="n">g_adcInIndex1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-546">			<span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span><span class="p">);</span>
</span><span id="line-547">			<span class="n">g_adcInIndex1</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">ADC_BUFFER_SIZE</span><span class="o">*</span><span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">);</span>
</span><span id="line-548">			<span class="k">if</span><span class="p">((</span><span class="n">g_adcInIndex1</span> <span class="o">%</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="line-549">			<span class="p">{</span>
</span><span id="line-550">				<span class="kt">int32_t</span> <span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_adcInIndex1</span> <span class="o">/</span> <span class="n">ADC_BUFFER_SIZE</span><span class="p">);</span>
</span><span id="line-551">				<span class="k">if</span><span class="p">(</span><span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">ready_buffer</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-552">					<span class="n">g_stall1</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-553">				<span class="n">ready_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">ready_buffer</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">)</span> <span class="o">%</span> <span class="n">ADC_BUFFER_WINDOW_COUNT</span><span class="p">;</span>
</span><span id="line-554">				<span class="n">g_adcPingPongStage1</span><span class="p">[</span><span class="n">ready_buffer</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="line-555">			<span class="p">}</span>
</span><span id="line-556">		<span class="p">}</span>
</span><span id="line-557">    <span class="p">}</span>
</span><span id="line-558"><span class="p">}</span>
</span><span id="line-559">
</span><span id="line-560">
</span><span id="line-561"><span class="c1">// Initialize ADC 0 0 uDMA transfer</span>
</span><span id="line-562"><span class="kt">void</span> <span class="n">InitADC00</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-563"><span class="p">{</span>
</span><span id="line-564">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_ADC0</span><span class="p">);</span>
</span><span id="line-565">	<span class="n">SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_ADC1</span><span class="p">);</span>
</span><span id="line-566">
</span><span id="line-567">	<span class="n">GPIOPinTypeADC</span><span class="p">(</span><span class="n">GPIO_PORTE_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_3</span> <span class="o">|</span> <span class="n">GPIO_PIN_2</span> <span class="o">|</span> <span class="n">GPIO_PIN_1</span> <span class="o">|</span> <span class="n">GPIO_PIN_0</span><span class="p">);</span> <span class="c1">// 0, 1, 2, 3</span>
</span><span id="line-568">	<span class="n">GPIOPinTypeADC</span><span class="p">(</span><span class="n">GPIO_PORTD_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_3</span> <span class="o">|</span> <span class="n">GPIO_PIN_2</span> <span class="o">|</span> <span class="n">GPIO_PIN_1</span> <span class="o">|</span> <span class="n">GPIO_PIN_0</span><span class="p">);</span> <span class="c1">// 4, 5, 6, 7</span>
</span><span id="line-569">
</span><span id="line-570">	<span class="n">ADCHardwareOversampleConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="n">HW_AVERAGE</span><span class="p">);</span>
</span><span id="line-571">	<span class="n">ADCSequenceConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ADC_TRIGGER_ALWAYS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-572">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ADC_CTL_CH0</span><span class="p">);</span>
</span><span id="line-573">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ADC_CTL_CH1</span><span class="p">);</span>
</span><span id="line-574">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-575">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-576">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-577">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-578">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-579">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="o">|</span><span class="n">ADC_CTL_IE</span><span class="o">|</span><span class="n">ADC_CTL_END</span><span class="p">);</span>
</span><span id="line-580">	<span class="n">ADCSequenceDMAEnable</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-581">
</span><span id="line-582">	<span class="c1">// adc 0</span>
</span><span id="line-583">    <span class="n">uDMAChannelAttributeDisable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span><span class="p">,</span>
</span><span id="line-584">                                    <span class="n">UDMA_ATTR_ALTSELECT</span> <span class="o">|</span> <span class="n">UDMA_ATTR_USEBURST</span> <span class="o">|</span>
</span><span id="line-585">                                    <span class="n">UDMA_ATTR_HIGH_PRIORITY</span> <span class="o">|</span>
</span><span id="line-586">                                    <span class="n">UDMA_ATTR_REQMASK</span><span class="p">);</span>
</span><span id="line-587">
</span><span id="line-588">    <span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-589">                            <span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_NONE</span> <span class="o">|</span> <span class="n">UDMA_DST_INC_32</span> <span class="o">|</span>
</span><span id="line-590">                              <span class="n">UDMA_ARB_8</span><span class="p">);</span>
</span><span id="line-591">
</span><span id="line-592">    <span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-593">    						<span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_NONE</span> <span class="o">|</span> <span class="n">UDMA_DST_INC_32</span> <span class="o">|</span>
</span><span id="line-594">                              <span class="n">UDMA_ARB_8</span><span class="p">);</span>
</span><span id="line-595">
</span><span id="line-596">    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-597">                               <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-598">							   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC0_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-599">							   <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-600">
</span><span id="line-601">    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-602">                               <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-603">							   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC0_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-604">							   <span class="o">&amp;</span><span class="n">g_adcPingPong0</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-605">    <span class="n">g_adcInIndex0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span id="line-606">
</span><span id="line-607">    <span class="c1">// adc 1</span>
</span><span id="line-608">	<span class="n">ADCHardwareOversampleConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="n">HW_AVERAGE</span><span class="p">);</span>
</span><span id="line-609">	<span class="n">ADCSequenceConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ADC_TRIGGER_ALWAYS</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span id="line-610">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ADC_CTL_CH0</span><span class="p">);</span>
</span><span id="line-611">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ADC_CTL_CH1</span><span class="p">);</span>
</span><span id="line-612">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-613">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-614">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-615">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-616">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="p">);</span>
</span><span id="line-617">	<span class="n">ADCSequenceStepConfigure</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">ADC_CTL_TS</span><span class="o">|</span><span class="n">ADC_CTL_IE</span><span class="o">|</span><span class="n">ADC_CTL_END</span><span class="p">);</span>
</span><span id="line-618">	<span class="n">ADCPhaseDelaySet</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="n">ADC_PHASE_180</span><span class="p">);</span>
</span><span id="line-619">	<span class="n">ADCSequenceDMAEnable</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-620">    <span class="n">uDMAChannelAttributeDisable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span><span class="p">,</span>
</span><span id="line-621">                                    <span class="n">UDMA_ATTR_ALTSELECT</span> <span class="o">|</span> <span class="n">UDMA_ATTR_USEBURST</span> <span class="o">|</span>
</span><span id="line-622">                                    <span class="n">UDMA_ATTR_HIGH_PRIORITY</span> <span class="o">|</span>
</span><span id="line-623">                                    <span class="n">UDMA_ATTR_REQMASK</span><span class="p">);</span>
</span><span id="line-624">
</span><span id="line-625">    <span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-626">                            <span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_NONE</span> <span class="o">|</span> <span class="n">UDMA_DST_INC_32</span> <span class="o">|</span>
</span><span id="line-627">                              <span class="n">UDMA_ARB_8</span><span class="p">);</span>
</span><span id="line-628">
</span><span id="line-629">    <span class="n">uDMAChannelControlSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-630">    						<span class="n">UDMA_SIZE_32</span> <span class="o">|</span> <span class="n">UDMA_SRC_INC_NONE</span> <span class="o">|</span> <span class="n">UDMA_DST_INC_32</span> <span class="o">|</span>
</span><span id="line-631">                              <span class="n">UDMA_ARB_8</span><span class="p">);</span>
</span><span id="line-632">
</span><span id="line-633">    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_PRI_SELECT</span><span class="p">,</span>
</span><span id="line-634">                               <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-635">							   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC1_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-636">							   <span class="o">&amp;</span><span class="n">g_adcPingPong1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-637">
</span><span id="line-638">    <span class="n">uDMAChannelTransferSet</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span> <span class="o">|</span> <span class="n">UDMA_ALT_SELECT</span><span class="p">,</span>
</span><span id="line-639">                               <span class="n">UDMA_MODE_PINGPONG</span><span class="p">,</span>
</span><span id="line-640">							   <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">ADC1_BASE</span> <span class="o">+</span> <span class="n">ADC_O_SSFIFO0</span><span class="p">),</span>
</span><span id="line-641">							   <span class="o">&amp;</span><span class="n">g_adcPingPong1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NUM_CHANNELS</span><span class="p">);</span>
</span><span id="line-642">    <span class="n">uDMAChannelAssign</span><span class="p">(</span><span class="n">UDMA_CH24_ADC1_0</span><span class="p">);</span>
</span><span id="line-643">    <span class="n">g_adcInIndex1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span id="line-644">
</span><span id="line-645">    <span class="c1">// both</span>
</span><span id="line-646">    <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_ADC0</span><span class="p">);</span>
</span><span id="line-647">    <span class="n">uDMAChannelEnable</span><span class="p">(</span><span class="n">UDMA_CHANNEL_SSI1RX</span><span class="p">);</span>
</span><span id="line-648">
</span><span id="line-649">	<span class="n">ADCIntClear</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-650">	<span class="n">ADCIntClear</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-651">	<span class="n">ADCIntEnable</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-652">	<span class="n">ADCIntEnable</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-653">	<span class="n">IntEnable</span><span class="p">(</span><span class="n">INT_ADC0SS0</span><span class="p">);</span>
</span><span id="line-654">	<span class="n">IntEnable</span><span class="p">(</span><span class="n">INT_ADC1SS0</span><span class="p">);</span>
</span><span id="line-655">
</span><span id="line-656">	<span class="n">ADCSequenceEnable</span><span class="p">(</span><span class="n">ADC0_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-657">	<span class="n">ADCSequenceEnable</span><span class="p">(</span><span class="n">ADC1_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span id="line-658"><span class="p">}</span>
</span><span id="line-659">
</span><span id="line-660"><span class="c1">//*****************************************************************************</span>
</span><span id="line-661"><span class="c1">//</span>
</span><span id="line-662"><span class="c1">// Configure the UART and its pins.  This must be called before UARTprintf().</span>
</span><span id="line-663"><span class="c1">//</span>
</span><span id="line-664"><span class="c1">//*****************************************************************************</span>
</span><span id="line-665"><span class="kt">void</span> <span class="n">ConfigureUART</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span><span id="line-666"><span class="p">{</span>
</span><span id="line-667">    <span class="c1">//</span>
</span><span id="line-668">    <span class="c1">// Enable the GPIO Peripheral used by the UART.</span>
</span><span id="line-669">    <span class="c1">//</span>
</span><span id="line-670">    <span class="n">ROM_SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_GPIOA</span><span class="p">);</span>
</span><span id="line-671">
</span><span id="line-672">    <span class="c1">//</span>
</span><span id="line-673">    <span class="c1">// Enable UART0</span>
</span><span id="line-674">    <span class="c1">//</span>
</span><span id="line-675">    <span class="n">ROM_SysCtlPeripheralEnable</span><span class="p">(</span><span class="n">SYSCTL_PERIPH_UART0</span><span class="p">);</span>
</span><span id="line-676">
</span><span id="line-677">    <span class="c1">//</span>
</span><span id="line-678">    <span class="c1">// Configure GPIO Pins for UART mode.</span>
</span><span id="line-679">    <span class="c1">//</span>
</span><span id="line-680">    <span class="n">ROM_GPIOPinConfigure</span><span class="p">(</span><span class="n">GPIO_PA0_U0RX</span><span class="p">);</span>
</span><span id="line-681">    <span class="n">ROM_GPIOPinConfigure</span><span class="p">(</span><span class="n">GPIO_PA1_U0TX</span><span class="p">);</span>
</span><span id="line-682">    <span class="n">ROM_GPIOPinTypeUART</span><span class="p">(</span><span class="n">GPIO_PORTA_BASE</span><span class="p">,</span> <span class="n">GPIO_PIN_0</span> <span class="o">|</span> <span class="n">GPIO_PIN_1</span><span class="p">);</span>
</span><span id="line-683">
</span><span id="line-684">    <span class="c1">//</span>
</span><span id="line-685">    <span class="c1">// Use the internal 16MHz oscillator as the UART clock source.</span>
</span><span id="line-686">    <span class="c1">//</span>
</span><span id="line-687">    <span class="n">UARTClockSourceSet</span><span class="p">(</span><span class="n">UART0_BASE</span><span class="p">,</span> <span class="n">UART_CLOCK_PIOSC</span><span class="p">);</span>
</span><span id="line-688">
</span><span id="line-689">    <span class="c1">//</span>
</span><span id="line-690">    <span class="c1">// Initialize the UART for console I/O.</span>
</span><span id="line-691">    <span class="c1">//</span>
</span><span id="line-692">    <span class="n">UARTStdioConfig</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">115200</span><span class="p">,</span> <span class="mi">16000000</span><span class="p">);</span>
</span><span id="line-693"><span class="p">}</span>
</span><span id="line-694">
</span><span id="line-695">
</span><span id="line-696"><span class="c1">//*****************************************************************************</span>
</span><span id="line-697"><span class="c1">//</span>
</span><span id="line-698"><span class="c1">// Handles bulk driver notifications related to the transmit channel (data to</span>
</span><span id="line-699"><span class="c1">// the USB host).</span>
</span><span id="line-700"><span class="c1">//</span>
</span><span id="line-701"><span class="c1">// \param pvCBData is the client-supplied callback pointer for this channel.</span>
</span><span id="line-702"><span class="c1">// \param ui32Event identifies the event we are being notified about.</span>
</span><span id="line-703"><span class="c1">// \param ui32MsgValue is an event-specific value.</span>
</span><span id="line-704"><span class="c1">// \param pvMsgData is an event-specific pointer.</span>
</span><span id="line-705"><span class="c1">//</span>
</span><span id="line-706"><span class="c1">// This function is called by the bulk driver to notify us of any events</span>
</span><span id="line-707"><span class="c1">// related to operation of the transmit data channel (the IN channel carrying</span>
</span><span id="line-708"><span class="c1">// data to the USB host).</span>
</span><span id="line-709"><span class="c1">//</span>
</span><span id="line-710"><span class="c1">// \return The return value is event-specific.</span>
</span><span id="line-711"><span class="c1">//</span>
</span><span id="line-712"><span class="c1">//*****************************************************************************</span>
</span><span id="line-713"><span class="kt">uint32_t</span>
</span><span id="line-714"><span class="n">TxHandler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pvCBData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">ui32Event</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">ui32MsgValue</span><span class="p">,</span>
</span><span id="line-715">          <span class="kt">void</span> <span class="o">*</span><span class="n">pvMsgData</span><span class="p">)</span>
</span><span id="line-716"><span class="p">{</span>
</span><span id="line-717">    <span class="c1">//</span>
</span><span id="line-718">    <span class="c1">// We are not required to do anything in response to any transmit event</span>
</span><span id="line-719">    <span class="c1">// in this example. All we do is update our transmit counter.</span>
</span><span id="line-720">    <span class="c1">//</span>
</span><span id="line-721">    <span class="k">if</span><span class="p">(</span><span class="n">ui32Event</span> <span class="o">==</span> <span class="n">USB_EVENT_TX_COMPLETE</span><span class="p">)</span>
</span><span id="line-722">    <span class="p">{</span>
</span><span id="line-723">        <span class="c1">//g_ui32TxCount += ui32MsgValue;</span>
</span><span id="line-724">    <span class="p">}</span>
</span><span id="line-725">
</span><span id="line-726">    <span class="c1">//</span>
</span><span id="line-727">    <span class="c1">// Dump a debug message.</span>
</span><span id="line-728">    <span class="c1">//</span>
</span><span id="line-729">    <span class="c1">//DEBUG_PRINT("TX complete %d\n", ui32MsgValue);</span>
</span><span id="line-730">
</span><span id="line-731">    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="line-732"><span class="p">}</span>
</span><span id="line-733">
</span><span id="line-734"><span class="c1">//*****************************************************************************</span>
</span><span id="line-735"><span class="c1">//</span>
</span><span id="line-736"><span class="c1">// Handles bulk driver notifications related to the receive channel (data from</span>
</span><span id="line-737"><span class="c1">// the USB host).</span>
</span><span id="line-738"><span class="c1">//</span>
</span><span id="line-739"><span class="c1">// \param pvCBData is the client-supplied callback pointer for this channel.</span>
</span><span id="line-740"><span class="c1">// \param ui32Event identifies the event we are being notified about.</span>
</span><span id="line-741"><span class="c1">// \param ui32MsgValue is an event-specific value.</span>
</span><span id="line-742"><span class="c1">// \param pvMsgData is an event-specific pointer.</span>
</span><span id="line-743"><span class="c1">//</span>
</span><span id="line-744"><span class="c1">// This function is called by the bulk driver to notify us of any events</span>
</span><span id="line-745"><span class="c1">// related to operation of the receive data channel (the OUT channel carrying</span>
</span><span id="line-746"><span class="c1">// data from the USB host).</span>
</span><span id="line-747"><span class="c1">//</span>
</span><span id="line-748"><span class="c1">// \return The return value is event-specific.</span>
</span><span id="line-749"><span class="c1">//</span>
</span><span id="line-750"><span class="c1">//*****************************************************************************</span>
</span><span id="line-751"><span class="kt">uint32_t</span>
</span><span id="line-752"><span class="n">RxHandler</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pvCBData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">ui32Event</span><span class="p">,</span>
</span><span id="line-753">               <span class="kt">uint32_t</span> <span class="n">ui32MsgValue</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pvMsgData</span><span class="p">)</span>
</span><span id="line-754"><span class="p">{</span>
</span><span id="line-755">    <span class="c1">//</span>
</span><span id="line-756">    <span class="c1">// Which event are we being sent?</span>
</span><span id="line-757">    <span class="c1">//</span>
</span><span id="line-758">    <span class="k">switch</span><span class="p">(</span><span class="n">ui32Event</span><span class="p">)</span>
</span><span id="line-759">    <span class="p">{</span>
</span><span id="line-760">        <span class="c1">//</span>
</span><span id="line-761">        <span class="c1">// We are connected to a host and communication is now possible.</span>
</span><span id="line-762">        <span class="c1">//</span>
</span><span id="line-763">        <span class="k">case</span> <span class="n">USB_EVENT_CONNECTED</span>:
</span><span id="line-764">        <span class="p">{</span>
</span><span id="line-765">            <span class="n">g_bUSBConfigured</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span><span id="line-766">            <span class="n">UARTprintf</span><span class="p">(</span><span class="s">"Host connected.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</span><span id="line-767">
</span><span id="line-768">            <span class="c1">//</span>
</span><span id="line-769">            <span class="c1">// Flush our buffers.</span>
</span><span id="line-770">            <span class="c1">//</span>
</span><span id="line-771">            <span class="n">USBBufferFlush</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sTxBuffer</span><span class="p">);</span>
</span><span id="line-772">            <span class="n">USBBufferFlush</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sRxBuffer</span><span class="p">);</span>
</span><span id="line-773">            <span class="n">IntMasterDisable</span><span class="p">();</span>
</span><span id="line-774">            <span class="n">g_usb_bytes_to_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-775">            <span class="n">IntMasterEnable</span><span class="p">();</span>
</span><span id="line-776">
</span><span id="line-777">            <span class="k">break</span><span class="p">;</span>
</span><span id="line-778">        <span class="p">}</span>
</span><span id="line-779">
</span><span id="line-780">        <span class="c1">//</span>
</span><span id="line-781">        <span class="c1">// The host has disconnected.</span>
</span><span id="line-782">        <span class="c1">//</span>
</span><span id="line-783">        <span class="k">case</span> <span class="n">USB_EVENT_DISCONNECTED</span>:
</span><span id="line-784">        <span class="p">{</span>
</span><span id="line-785">            <span class="n">g_bUSBConfigured</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span><span id="line-786">            <span class="n">UARTprintf</span><span class="p">(</span><span class="s">"Host disconnected.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
</span><span id="line-787">            <span class="k">break</span><span class="p">;</span>
</span><span id="line-788">        <span class="p">}</span>
</span><span id="line-789">
</span><span id="line-790">        <span class="c1">//</span>
</span><span id="line-791">        <span class="c1">// A new packet has been received.</span>
</span><span id="line-792">        <span class="c1">//</span>
</span><span id="line-793">        <span class="k">case</span> <span class="n">USB_EVENT_RX_AVAILABLE</span>:
</span><span id="line-794">        <span class="p">{</span>
</span><span id="line-795">            <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span id="line-796">
</span><span id="line-797">            <span class="c1">//</span>
</span><span id="line-798">            <span class="c1">// Read the command 0xAA</span>
</span><span id="line-799">            <span class="c1">//</span>
</span><span id="line-800">            <span class="c1">// byte 0: command = 0xAA read</span>
</span><span id="line-801">            <span class="c1">// byte 1: MSB buffer size</span>
</span><span id="line-802">            <span class="c1">// byte 2: LSB buffer size</span>
</span><span id="line-803">
</span><span id="line-804">            <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="o">*</span><span class="p">)</span><span class="n">pvMsgData</span><span class="p">;</span>
</span><span id="line-805">            <span class="kt">uint8_t</span> <span class="n">pwm</span><span class="p">;</span>
</span><span id="line-806">			<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">ui32MsgValue</span><span class="p">;</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">--</span><span class="p">)</span>
</span><span id="line-807">			<span class="p">{</span>
</span><span id="line-808">				<span class="k">switch</span><span class="p">(</span><span class="n">g_msg_index</span><span class="p">)</span>
</span><span id="line-809">				<span class="p">{</span>
</span><span id="line-810">				<span class="nl">default:</span>
</span><span id="line-811">				<span class="k">case</span> <span class="mi">0</span>:
</span><span id="line-812">					<span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span>
</span><span id="line-813">					<span class="p">{</span>
</span><span id="line-814">						<span class="n">g_msg_index</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-815">					<span class="p">}</span>
</span><span id="line-816">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-817">				<span class="k">case</span> <span class="mi">1</span>:
</span><span id="line-818">					<span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">==</span> <span class="mh">0xAA</span><span class="p">)</span>
</span><span id="line-819">						<span class="n">g_msg_index</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-820">					<span class="k">else</span>
</span><span id="line-821">						<span class="n">g_msg_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-822">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-823">				<span class="k">case</span> <span class="mi">2</span>:
</span><span id="line-824">					<span class="n">g_usb_receive_size</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">*</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
</span><span id="line-825">					<span class="n">g_msg_index</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-826">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-827">				<span class="k">case</span> <span class="mi">3</span>:
</span><span id="line-828">					<span class="n">g_usb_receive_size</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span><span id="line-829">					<span class="k">if</span><span class="p">(</span><span class="n">g_usb_receive_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="line-830">					<span class="p">{</span>
</span><span id="line-831">						<span class="n">IntMasterDisable</span><span class="p">();</span>
</span><span id="line-832">						<span class="n">g_usb_bytes_to_read</span> <span class="o">+=</span> <span class="n">g_usb_receive_size</span><span class="p">;</span>
</span><span id="line-833">						<span class="n">IntMasterEnable</span><span class="p">();</span>
</span><span id="line-834">					<span class="p">}</span>
</span><span id="line-835">					<span class="n">g_msg_index</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-836">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-837">				<span class="k">case</span> <span class="mi">4</span>:
</span><span id="line-838">					<span class="n">pwm</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span><span id="line-839">					<span class="n">pwm</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">pwm</span><span class="p">,</span> <span class="n">PWM_MAX</span><span class="p">);</span>
</span><span id="line-840">					<span class="n">pwm</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">pwm</span><span class="p">,</span> <span class="n">PWM_MIN</span><span class="p">);</span>
</span><span id="line-841">					<span class="n">g_ui8AdjustPending</span> <span class="o">=</span> <span class="n">pwm</span><span class="p">;</span>
</span><span id="line-842">					<span class="c1">//if(g_ui8AdjustPending != g_ui8Adjust)</span>
</span><span id="line-843">					<span class="c1">//{</span>
</span><span id="line-844">					<span class="c1">// cause stack overflow</span>
</span><span id="line-845">					<span class="c1">//UARTprintf("pwm:%d\n", g_ui8AdjustPending);</span>
</span><span id="line-846">					<span class="c1">//}</span>
</span><span id="line-847">					<span class="n">g_msg_index</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-848">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-849">				<span class="k">case</span> <span class="mi">5</span>:
</span><span id="line-850">					<span class="n">g_fire</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">);</span>
</span><span id="line-851">					<span class="n">g_msg_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span id="line-852">					<span class="k">break</span><span class="p">;</span>
</span><span id="line-853">				<span class="p">}</span>
</span><span id="line-854">				<span class="n">data</span><span class="o">++</span><span class="p">;</span>
</span><span id="line-855">				<span class="k">if</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="o">&amp;</span><span class="n">g_pui8USBRxBuffer</span><span class="p">[</span><span class="n">BULK_RX_BUFFER_SIZE</span><span class="p">])</span>
</span><span id="line-856">				<span class="p">{</span>
</span><span id="line-857">					<span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">g_pui8USBRxBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span id="line-858">				<span class="p">}</span>
</span><span id="line-859">
</span><span id="line-860">            <span class="p">}</span>
</span><span id="line-861">			<span class="n">USBBufferDataRemoved</span><span class="p">(</span><span class="o">&amp;</span><span class="n">g_sRxBuffer</span><span class="p">,</span> <span class="n">ui32MsgValue</span><span class="p">);</span>
</span><span id="line-862">            <span class="k">break</span><span class="p">;</span>
</span><span id="line-863">        <span class="p">}</span>
</span><span id="line-864">
</span><span id="line-865">        <span class="c1">//</span>
</span><span id="line-866">        <span class="c1">// Ignore SUSPEND and RESUME for now.</span>
</span><span id="line-867">        <span class="c1">//</span>
</span><span id="line-868">        <span class="k">case</span> <span class="n">USB_EVENT_SUSPEND</span>:
</span><span id="line-869">        <span class="k">case</span> <span class="n">USB_EVENT_RESUME</span>:
</span><span id="line-870">        <span class="p">{</span>
</span><span id="line-871">            <span class="k">break</span><span class="p">;</span>
</span><span id="line-872">        <span class="p">}</span>
</span><span id="line-873">
</span><span id="line-874">        <span class="c1">//</span>
</span><span id="line-875">        <span class="c1">// Ignore all other events and return 0.</span>
</span><span id="line-876">        <span class="c1">//</span>
</span><span id="line-877">        <span class="nl">default:</span>
</span><span id="line-878">        <span class="p">{</span>
</span><span id="line-879">            <span class="k">break</span><span class="p">;</span>
</span><span id="line-880">        <span class="p">}</span>
</span><span id="line-881">    <span class="p">}</span>
</span><span id="line-882">
</span><span id="line-883">    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="line-884"><span class="p">}</span>
</span></pre>
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="section-container" id="team">
          <h2 class="section-title">
           <span class="title">
            Credits
           </span>
          </h2>
          <div class="section-content">
           <div class="member-thumb media">
            <div class="media-left">
             <a href="/graham_chow">
              <img alt="Logo 300x300" class="img-circle media-object" src="https://hackster.imgix.net/uploads/avatar/file/123294/logo_300x300.png?w=40&amp;h=40&amp;fit=min"/>
             </a>
            </div>
            <div class="member-thumb-body media-body">
             <h5 class="media-heading">
              <a href="/graham_chow">
               Graham Chow
              </a>
             </h5>
             <p>
              I'm a software developer on a long sabbatical. I've had wide experience from banking to underwater military sonar systems.
             </p>
             <div class="member-actions">
              <a class="follow-button btn btn-primary btn-sm btn-shorter show-simplified-signup" data-redirect-to="/followers/create?followable_id=19541&amp;followable_type=User&amp;source=projects%23show" data-source="follow_user" href="/users/sign_up?id=19541&amp;m=user&amp;reason=follow&amp;redirect_to=%2Ffollowers%2Fcreate%3Ffollowable_id%3D19541%26followable_type%3DUser">
               Follow
              </a>
              <a class="btn btn-link btn-sm" href="/messages/new?recipient_id=19541">
               Contact
              </a>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="section-container" id="comments">
          <h2 class="section-title">
           <span class="title title-toggle">
            Comments
           </span>
          </h2>
          <div class="section-content">
           <div class="comments">
            <div class="user-signed-out" style="display:none">
             <p class="sign-up-to-comment">
              Please
              <a href="/users/sign_in?id=13358&amp;m=base_article&amp;reason=comment&amp;redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab%23comments">
               log in
              </a>
              or
              <a href="/users/sign_up?id=13358&amp;m=base_article&amp;reason=comment&amp;redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab%23comments&amp;source=popup">
               sign up
              </a>
              to comment.
             </p>
            </div>
            <div data-react-class="Comments" data-react-props='{"commentable":{"id":13358,"type":"BaseArticle"},"placeholder":"Share your thoughts! What do you like about this project? How could it be improved? Be respectful and constructive â€“ most Hackster members create and share personal projects in their free time.","cacheVersion":null}'>
            </div>
           </div>
          </div>
         </section>
        </div>
        <div class="col-md-4 right-column">
         <section class="section-thumbs hidden-xs hidden-sm">
          <div class="affixable" data-top="20" id="project-side-nav" style="top:20px">
           <div class="section-container" id="scroll-nav">
            <ul class="nav">
             <li class="active">
              <a class="smooth-scroll" data-offset="-40" href="#home">
               Acoustic Localisation
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#things">
               Things
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#about-project">
               Story
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#schematics">
               Schematics
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#code">
               Code
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#team">
               Credits
              </a>
             </li>
             <li>
              <a class="smooth-scroll" href="#comments">
               Comments
               <span class="nav-count">
                (0)
               </span>
              </a>
             </li>
            </ul>
           </div>
           <div class="show-on-affix" style="margin-top:15px;">
            <div class="async-respect-btn-placeholder">
            </div>
            <a class="btn btn-sm btn-secondary" href="/users/sign_in?redirect_to=%2Fgraham_chow%2Facoustic-localisation-c7c8ab">
             <i class="fa fa-bookmark-o">
             </i>
            </a>
            <a class="btn btn-secondary btn-sm" data-content="&lt;div class='sharing-actions'&gt;&lt;ul&gt;&lt;li&gt;&lt;a class='social-share-link clearfix' data-url='https://www.facebook.com/dialog/feed?app_id=543757942384158&amp;amp;link=https%3A%2F%2Fwww.hackster.io%2Fgraham_chow%2Facoustic-localisation-c7c8ab&amp;amp;name=Acoustic+Localisation&amp;amp;description=Awesome+project%3A+Acoustic+Localisation+by+Graham+Chow&amp;amp;picture=https%3A%2F%2Fhackster.imgix.net%2Fuploads%2Fcover_image%2Ffile%2F81535%2FPA090979.JPG%3Fw%3D400%26h%3D300%26fit%3Dmin&amp;amp;redirect_uri=http%3A%2F%2Ffacebook.com' href=''&gt;&lt;i class='fa fa-facebook'&gt;&lt;/i&gt;&lt;span&gt;Share on Facebook&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a class='social-share-link clearfix' data-url='https://twitter.com/intent/tweet?text=Awesome+project%3A+Acoustic+Localisation+by+Graham+Chow&amp;amp;url=https%3A%2F%2Fwww.hackster.io%2Fgraham_chow%2Facoustic-localisation-c7c8ab' href=''&gt;&lt;i class='fa fa-twitter'&gt;&lt;/i&gt;&lt;span&gt;Share on Twitter&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;" data-html="true" data-placement="bottom" data-toggle="popover" data-trigger="click">
             <i class="fa fa-share-square-o">
             </i>
            </a>
           </div>
          </div>
         </section>
        </div>
       </div>
      </div>
     </section>
     <section class="section-other-projects">
      <div class="container">
       <section class="section-thumbs">
        <h4 style="border:0">
         Similar projects you might like
        </h4>
       </section>
       <div class="row">
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="0" data-ref="similar" data-ref-id="13358">
         <div class="project-19412">
          <div class="project-card">
           <div class="card-image">
            <img alt="Mazdaspeed 3 e85 Tuning Project and Guide" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/145793/mazda.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="Mazdaspeed 3 e85 Tuning Project and Guide" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/145793/mazda.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/17348/mazdaspeed-3-e85-tuning-project-and-guide-448db3">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-bullseye">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                759
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                19
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-bullseye">
              </i>
              <span>
               Protip
              </span>
             </p>
             <p>
              The purpose of this project is to investigate the general tuning process required to use e85 fuel for extra power.
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/17348/mazdaspeed-3-e85-tuning-project-and-guide-448db3">
              Mazdaspeed 3 e85 Tuning Project and Guide
             </a>
            </h4>
            <p>
             <span class="user-name">
              <a href="/hpatter7">
               Harry C Patterson
              </a>
             </span>
             and
             <span class="user-name">
              <a href="/tlambet2">
               Tyler Lambeth
              </a>
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="1" data-ref="similar" data-ref-id="13358">
         <div class="project-19895">
          <div class="project-card">
           <div class="card-image">
            <img alt="RF BASED SMART HOME AUTOMATION SYSTEM" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/150081/connections.png?w=400&amp;h=300&amp;fit=min" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="RF BASED SMART HOME AUTOMATION SYSTEM" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/150081/connections.png?w=400&amp;h=300&amp;fit=min"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/dennismwanza/rf-based-smart-home-automation-system-fe5195">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-bullseye">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                378
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                3
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-bullseye">
              </i>
              <span>
               Protip
              </span>
             </p>
             <p>
              The main objective of this project is to develop a smart home automation system with a button key fob transmitter by using RF.
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/dennismwanza/rf-based-smart-home-automation-system-fe5195">
              RF BASED SMART HOME AUTOMATION SYSTEM
             </a>
            </h4>
            <p>
             <span class="user-name">
              <a href="/dennismwanza">
               Dennis Mwanza
              </a>
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="2" data-ref="similar" data-ref-id="13358">
         <div class="project-18926">
          <div class="project-card">
           <div class="card-image">
            <img alt="Arduino Yun MQTT Sensor Node" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/142553/GasNode.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="Arduino Yun MQTT Sensor Node" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/142553/GasNode.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/stefaanv/arduino-yun-mqtt-sensor-node-2ac2ce">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-battery-half">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                347
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                5
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-battery-half">
              </i>
              <span>
               Work in progress
              </span>
             </p>
             <p>
              MQTT sensor node based on the Arduino Yun compatible Seeeduino Cloud device.
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/stefaanv/arduino-yun-mqtt-sensor-node-2ac2ce">
              Arduino Yun MQTT Sensor Node
             </a>
            </h4>
            <p>
             <span class="user-name">
              <a href="/stefaanv">
               Stefaan Vandevelde
              </a>
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="3" data-ref="similar" data-ref-id="13358">
         <div class="project-10663">
          <div class="project-card">
           <div class="card-image">
            <img alt="SmartWindow" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/58526/smartWindow.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="SmartWindow" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/58526/smartWindow.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/team-tinterns/smartwindow-bc9ff3">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-book">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                4,229
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                103
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-book">
              </i>
              <span>
               Full instructions
              </span>
             </p>
             <p>
              A window that tints itself according to how much light is incident upon it. You can also control the window with an iOS application!
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/team-tinterns/smartwindow-bc9ff3">
              SmartWindow
             </a>
            </h4>
            <p>
             <span class="user-name">
              Team TINTerns
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="4" data-ref="similar" data-ref-id="13358">
         <div class="project-10236">
          <div class="project-card">
           <div class="card-image">
            <img alt="The Wingman" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/58590/20150724_001937.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="The Wingman" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/58590/20150724_001937.jpg?w=400&amp;h=300&amp;fit=min&amp;fm=jpg"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/cycling-safer/the-wingman-has-your-back-184ef0">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-book">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                2,168
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                57
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-book">
              </i>
              <span>
               Full instructions
              </span>
             </p>
             <p>
              When it comes to bicycle safety and theft-prevention, The Wingman has your back.
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/cycling-safer/the-wingman-has-your-back-184ef0">
              The Wingman
             </a>
            </h4>
            <p>
             <span class="user-name">
              Team The Wingmen
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
        <div class="col-sm-6 mobile-scroll-row-item project-thumb-container col-md-4 has-data" data-offset="5" data-ref="similar" data-ref-id="13358">
         <div class="project-11726">
          <div class="project-card">
           <div class="card-image">
            <img alt="Home Automation (with Raspberry Pi 2 and Windows 10 IoT)" class="cover-img" data-async-src="https://hackster.imgix.net/uploads/cover_image/file/81451/Overview_4to3.png?w=400&amp;h=300&amp;fit=min" src="https://www.hackster.io/assets/transparent-3619cd3e7f715bef1d81a4b4a203a2b8.gif"/>
            <noscript>
             <img alt="Home Automation (with Raspberry Pi 2 and Windows 10 IoT)" class="cover-img loaded" src="https://hackster.imgix.net/uploads/cover_image/file/81451/Overview_4to3.png?w=400&amp;h=300&amp;fit=min"/>
            </noscript>
            <a class="link-overlay project-link-with-ref" href="/cyborg-titanium-14/home-automation-with-raspberry-pi-2-and-windows-10-iot-784235">
            </a>
            <div class="card-image-inner clearfix">
             <div class="project-difficulty pull-left">
              <span class="label label-danger label-hollow">
               Advanced
              </span>
             </div>
             <div class="pull-left project-content-type">
              <i class="fa fa-book">
              </i>
             </div>
             <div class="award-container pull-left">
             </div>
             <ul class="list-inline project-stats pull-right">
              <li>
               <i class="fa fa-eye">
               </i>
               <span class="stat-figure">
                47,141
               </span>
              </li>
              <li>
               <i class="fa fa-thumbs-o-up">
               </i>
               <span class="stat-figure">
                180
               </span>
              </li>
             </ul>
            </div>
            <div class="card-image-overlay">
             <div class="award-container">
             </div>
             <p class="project-content-type">
              <i class="fa fa-book">
              </i>
              <span>
               Full instructions
              </span>
             </p>
             <p>
              Open source Home Automation SDK including Hardware
             </p>
            </div>
           </div>
           <div class="card-text">
            <h4>
             <a class="project-link-with-ref" href="/cyborg-titanium-14/home-automation-with-raspberry-pi-2-and-windows-10-iot-784235">
              Home Automation (with Raspberry Pi 2 and Windows 10 IoT)
             </a>
            </h4>
            <p>
             <span class="user-name">
              <a href="/cyborg-titanium-14">
               Christian Kratky
              </a>
             </span>
            </p>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </section>
    </div>
   </div>
  </div>
  <footer>
   <div class="footer-nav">
    <div class="container clearfix">
     <ul class="list-unstyled pull-left">
      <li>
       <h3>
        More cool stuff
       </h3>
      </li>
      <li>
       <a href="/community">
        Community
       </a>
      </li>
      <li>
       <a href="/lists">
        Curated lists
       </a>
      </li>
      <li>
       <a href="/store">
        Free Store
       </a>
      </li>
      <li>
       <a href="/hardwareweekend">
        Hardware Weekend
       </a>
      </li>
      <li>
       <a href="/hackerspaces">
        Hacker spaces
       </a>
      </li>
     </ul>
     <ul class="list-unstyled pull-left">
      <li>
       <h3>
        Legal thingies
       </h3>
      </li>
      <li>
       <a href="/terms">
        Terms of Service
       </a>
      </li>
      <li>
       <a href="/conduct">
        Code of Conduct
       </a>
      </li>
      <li>
       <a href="/privacy">
        Privacy Policy
       </a>
      </li>
     </ul>
     <ul class="list-unstyled pull-left">
      <li>
       <h3>
        About us
       </h3>
      </li>
      <li>
       <a href="/about">
        Hackster's story
       </a>
      </li>
      <li>
       <a href="/blog">
        Our kickass blog
       </a>
      </li>
      <li>
       <a href="/business">
        Hackster for business
       </a>
      </li>
      <li>
       <a href="https://hacksterio.freshdesk.com/support/home" target="_blank">
        Support center
       </a>
      </li>
      <li>
       <a href="/jobs">
        Jobs
       </a>
      </li>
     </ul>
     <ul class="list-unstyled pull-left">
      <li>
       <h3>
        We're fairly social people
       </h3>
      </li>
      <li>
       <a href="https://www.facebook.com/hacksterio">
        <i class="fa fa-facebook">
        </i>
        <span>
         Facebook
        </span>
       </a>
      </li>
      <li>
       <a href="https://www.twitter.com/hacksterio">
        <i class="fa fa-twitter">
        </i>
        <span>
         Twitter
        </span>
       </a>
      </li>
      <li>
       <a href="https://www.youtube.com/hacksterio">
        <i class="fa fa-youtube">
        </i>
        <span>
         Youtube
        </span>
       </a>
      </li>
     </ul>
     <ul class="list-unstyled list-inline pull-right">
      <li>
       Hackster, Inc. 2016
      </li>
     </ul>
    </div>
   </div>
  </footer>
  <div class="popup-overlay modal-popup" data-width="450" id="login-popup">
   <div class="popup-overlay-bg">
   </div>
   <div class="popup-overlay-outer">
    <div class="popup-overlay-inner">
     <button class="close" data-target="#login-popup">
      Ã—
     </button>
     <h4>
      Good to see you again
     </h4>
     <form accept-charset="UTF-8" action="/users/sign_in" class="simple_form form-compact disable-on-submit user-form" id="login-form" method="post" novalidate="novalidate">
      <input name="utf8" type="hidden" value="âœ“"/>
      <div class="form-group email optional user_email">
       <input autofocus="autofocus" class="string email optional form-control form-control" id="user_email" maxlength="255" name="user[email]" placeholder="Email" size="255" type="email" value=""/>
      </div>
      <div class="form-group password optional user_password">
       <input class="password optional form-control" id="user_password" maxlength="128" name="user[password]" placeholder="Password" size="128" type="password"/>
      </div>
      <div class="form-group boolean optional user_remember_me">
       <input name="user[remember_me]" type="hidden" value="0"/>
       <label class="checkbox">
        <input checked="checked" class="boolean optional" id="user_remember_me" name="user[remember_me]" type="checkbox" value="1"/>
        Keep me signed in on this device
       </label>
      </div>
      <input class="btn-block btn btn-primary" type="submit" value="Log into my account"/>
      <a class="forgot-pass" href="/users/password/new">
       Forgot your password?
      </a>
     </form>
     <hr/>
     <div class="social-icons text-center">
      <p class="text-muted">
       <small>
        Or connect with your social account:
       </small>
      </p>
      <a class="zocial icon facebook" href="https://www.hackster.io/users/auth/facebook?login_locale=en&amp;setup=true">
       Facebook
      </a>
      <a class="zocial icon github" href="https://www.hackster.io/users/auth/github?login_locale=en&amp;setup=true">
       Github
      </a>
      <a class="zocial icon googleplus" href="https://www.hackster.io/users/auth/gplus?login_locale=en&amp;setup=true">
       Google+
      </a>
      <a class="zocial icon twitter" href="https://www.hackster.io/users/auth/twitter?login_locale=en&amp;setup=true">
       Twitter
      </a>
      <a class="zocial icon windows" href="https://www.hackster.io/users/auth/windowslive?login_locale=en&amp;setup=true">
       Microsoft Account
      </a>
     </div>
     <hr/>
     <p>
      <small>
       New here?
       <a href="/users/sign_up">
        Create an account
       </a>
      </small>
     </p>
    </div>
   </div>
  </div>
  <div class="hide-on-desktop" id="mobile-nav-overlay">
   <div class="fa fa-times" id="mobile-nav-overlay-close">
   </div>
  </div>
  <div class="hide-on-desktop" id="mobile-navigation">
   <form action="/search" class="navbar-form" method="get">
    <div class="form-group">
     <div class="input-group">
      <span class="input-group-addon">
       <i class="fa fa-search">
       </i>
      </span>
      <input class="form-control" id="q" name="q" placeholder="Search" type="text"/>
     </div>
    </div>
   </form>
   <a class="mo-nav-link" href="/projects?ref=topnav">
    Projects
   </a>
   <a class="mo-nav-link" href="/platforms">
    Platforms
   </a>
   <a class="mo-nav-link" href="/challenges">
    Challenges
   </a>
   <a class="mo-nav-link" href="/live">
    Live
   </a>
   <a class="mo-nav-link" href="/store">
    Free Store
   </a>
   <a class="mo-nav-link" href="/blog">
    Blog
   </a>
   <a class="mo-nav-link" href="/projects/new">
    <i class="fa fa-plus">
    </i>
    <span>
     Add project
    </span>
   </a>
   <a class="mo-nav-link" href="/users/sign_up">
    Sign up / Login
   </a>
  </div>
  <div class="loading-bar">
  </div>
  <script src="/assets/application-466772722aae95154631849d1ef7963d.js">
  </script>
  <script type="text/javascript">
   $(function(){
        $.ajax({
          url: 'https://api.hackster.io/private/stats',
          data: {
            referrer: (document.referrer || document.origin),
      
          id: '13358',
          type: 'BaseArticle',
      
          a: 'show',
          c: 'projects'
        },
        xhrFields: {
          withCredentials: true
        },
        method: 'POST'
      });
    });
  </script>
  <script>
   $(function(){ fetchHelloWorld(); });
  </script>
  <div class="async-respect-btn hide">
   <a class="respect-button btn btn-sm btn-primary show-simplified-signup base_article-13358-respect" data-container="body" data-redirect-to="/articles/13358/respects/create" data-source="respect_project" href="/users/sign_up?id=13358&amp;m=article&amp;reason=respect&amp;redirect_to=%2Farticles%2F13358%2Frespects%2Fcreate">
    <i class="fa fa-thumbs-o-up">
    </i>
    <span>
     Respect project
    </span>
   </a>
  </div>
  <script>
   $(function(){
  var s = "<span class='stat-figure'>1,184</span>";
  $('.impression-stats .stat-figure').replaceWith(s);
  s = "<span class='stat-figure'>18</span>";
  $('.respect-stats .stat-figure').replaceWith(s);

  var respectBtn = $('.async-respect-btn').html();
  $('.async-respect-btn-placeholder').replaceWith(respectBtn);
});
  </script>
  <script type="text/javascript">
   $(function() {
        $("body").on('click', 'a', function(e){
          var url = $(this).attr("href");
          if (e.currentTarget.host != window.location.host && url && url.indexOf('javascript:') == -1) {
            ga('send', 'event', 'Outbound Links', e.currentTarget.host.replace(':80', ''), url);
            if (e.metaKey || e.ctrlKey || this.target == "_blank") {
              var newtab = true;
            }
            if (!newtab) {
              e.preventDefault();
              setTimeout('document.location = "' + url + '"', 100);
            }
          }
        });
        $('.project-switcher').on('click', function(e){
          var url = $(this).attr("href");
          var dir = url.match(/dir=([a-z]+)/)[1];
          ga('send', 'event', 'ProjectSwitcher', dir, url);
          if (e.metaKey || e.ctrlKey) {
            var newtab = true;
          }
          if (!newtab) {
            e.preventDefault();
            setTimeout('document.location = "' + url + '"', 100);
          }
        });
      });
  </script>
  <div data-uv-autoprompt="" id="uv-prompt" style="position: fixed; bottom: 5px; right: 5px">
  </div>
  <script>
   UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/xFTFtFNd8ckhCsF2fnhXaA.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

  // Set colors
  UserVoice.push(['set', {
    accent_color: '#448dd6',
    trigger_color: 'white',
    trigger_background_color: 'rgba(46, 49, 51, 0.6)',
    'menu_enabled': false
  }]);

  // Identify the user and pass traits

  // Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
  UserVoice.push(['autoprompt', {
    target: '#uv-prompt',
    position: 'top'
  }]);
  </script>
 </body>
</html>